
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ms3.parse &#8212; ms3 1.2.4.post0.dev2+gf30d960 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=796348d33e8b1d947c94" rel="stylesheet">
<link href="../../_static/styles/bootstrap.css?digest=796348d33e8b1d947c94" rel="stylesheet">
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=796348d33e8b1d947c94" rel="stylesheet">

  
  <link href="../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=796348d33e8b1d947c94" rel="stylesheet">
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2">
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2">
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/jupyter-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/thebelab.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=796348d33e8b1d947c94">
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=796348d33e8b1d947c94">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/thebelab-helper.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '_modules/ms3/parse';</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="docsearch:language" content="en">
  </head>
  
  
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="180" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>

  
  <input type="checkbox" class="sidebar-toggle" name="__primary" id="__primary">
  <label class="overlay overlay-primary" for="__primary"></label>

  
  <input type="checkbox" class="sidebar-toggle" name="__secondary" id="__secondary">
  <label class="overlay overlay-secondary" for="__secondary"></label>

  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
      
<form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
    </div>
  </div>

  
  <nav class="bd-header navbar navbar-expand-lg bd-navbar" id="navbar-main"><div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
      <span class="fa-solid fa-bars"></span>
  </label>
  <div id="navbar-start">
    
    
  


<a class="navbar-brand logo" href="../../index.html">

  
  
  
  
  
  
  

  
  
    <p class="title logo__title">ms3 1.2.4.post0.dev2+gf30d960 documentation</p>
  
</a>
    
  </div>

  
  <div class="col-lg-9 navbar-header-items">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <nav class="navbar-nav">
    <p class="sidebar-header-items__title" role="heading" aria-level="1" aria-label="Site Navigation">
        Site Navigation
    </p>
    <ul id="navbar-main-elements" class="navbar-nav">
        
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../install.html">
                        Installation
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../quick.html">
                        Quick Reference
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../manual/index.html">
                        Manual
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../reference.html">
                        Developers' Reference
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../license.html">
                        License
                      </a>
                    </li>
                
            <div class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    More
                </button>
                <div class="dropdown-menu">
                    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../authors.html">
                        Authors
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../changelog.html">
                        Changelog
                      </a>
                    </li>
                
                </div>
            </div>
            
    </ul>
</nav>
      </div>
      
    </div>

    <div id="navbar-end">
      
        <div class="navbar-end-item navbar-persistent--container">
          
<button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-toggle="tooltip">
  <i class="fa-solid fa-magnifying-glass"></i>
</button>
        </div>
      
      
      <div class="navbar-end-item">
        <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
</button>
      </div>
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
      </ul>
      </div>
      
    </div>
  </div>


  
  
    <div class="navbar-persistent--mobile">
<button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-toggle="tooltip">
  <i class="fa-solid fa-magnifying-glass"></i>
</button>
    </div>
  

  
  <label class="sidebar-toggle secondary-toggle" for="__secondary">
      <span class="fa-solid fa-outdent"></span>
  </label>
  

</div>
  </nav>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        
  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
      
      <div class="navbar-center-item">
        <nav class="navbar-nav">
    <p class="sidebar-header-items__title" role="heading" aria-level="1" aria-label="Site Navigation">
        Site Navigation
    </p>
    <ul id="navbar-main-elements" class="navbar-nav">
        
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../install.html">
                        Installation
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../quick.html">
                        Quick Reference
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../manual/index.html">
                        Manual
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../reference.html">
                        Developers' Reference
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../license.html">
                        License
                      </a>
                    </li>
                
            <div class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    More
                </button>
                <div class="dropdown-menu">
                    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../authors.html">
                        Authors
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../changelog.html">
                        Changelog
                      </a>
                    </li>
                
                </div>
            </div>
            
    </ul>
</nav>
      </div>
      
      </div>
    

    
    
    <div class="sidebar-header-items__end">
      
      <div class="navbar-end-item">
        <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
</button>
      </div>
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
      </ul>
      </div>
      
    </div>
    
  </div>

  
  <div class="sidebar-start-items sidebar-primary__section">
    <div class="sidebar-start-items__item">
<h3><a href="../../index.html">Table of Contents</a></h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../quick.html">Quick Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../manual/index.html">Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../reference.html">Developers' Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../license.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../authors.html">Authors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../changelog.html">Changelog</a></li>
</ul>

    </div>
    <div class="sidebar-start-items__item">
    </div>
    <div class="sidebar-start-items__item">
    </div>
    <div class="sidebar-start-items__item">
<div id="searchbox"></div>
    </div>
  </div>
  

  
  <div class="sidebar-end-items sidebar-primary__section">
    <div class="sidebar-end-items__item">
    </div>
  </div>

  
  <div id="rtd-footer-container"></div>

      </div>
      <main id="main-content" class="bd-main">
        
        
        <div class="bd-content">
          <div class="bd-article-container">
            
            <div class="bd-header-article">
                
            </div>
            
            
            <article class="bd-article" role="main">
              
  <h1>Source code for ms3.parse</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Literal</span><span class="p">,</span> <span class="n">Collection</span><span class="p">,</span> <span class="n">Generator</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Union</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Iterator</span>

<span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">Counter</span><span class="p">,</span> <span class="n">defaultdict</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="kn">from</span> <span class="nn">.corpus</span> <span class="kn">import</span> <span class="n">Corpus</span>
<span class="kn">from</span> <span class="nn">.logger</span> <span class="kn">import</span> <span class="n">LoggedClass</span>
<span class="kn">from</span> <span class="nn">.piece</span> <span class="kn">import</span> <span class="n">Piece</span>
<span class="kn">from</span> <span class="nn">._typing</span> <span class="kn">import</span> <span class="n">FileDict</span><span class="p">,</span> <span class="n">FileList</span><span class="p">,</span> <span class="n">CorpusFnameTuple</span><span class="p">,</span> <span class="n">ScoreFacets</span><span class="p">,</span> <span class="n">FacetArguments</span><span class="p">,</span> <span class="n">FileParsedTuple</span><span class="p">,</span> <span class="n">FileDataframeTuple</span><span class="p">,</span> <span class="n">ScoreFacet</span><span class="p">,</span> <span class="n">AnnotationsFacet</span><span class="p">,</span> <span class="n">Facet</span>
<span class="kn">from</span> <span class="nn">.utils</span> <span class="kn">import</span> <span class="n">get_musescore</span><span class="p">,</span> <span class="n">get_first_level_corpora</span><span class="p">,</span> <span class="n">pretty_dict</span><span class="p">,</span> <span class="n">resolve_dir</span><span class="p">,</span> \
    <span class="n">update_labels_cfg</span><span class="p">,</span> <span class="n">available_views2str</span><span class="p">,</span> <span class="n">path2parent_corpus</span><span class="p">,</span> <span class="n">resolve_paths_argument</span><span class="p">,</span> <span class="n">enforce_fname_index_for_metadata</span><span class="p">,</span> <span class="n">File</span>
<span class="kn">from</span> <span class="nn">.view</span> <span class="kn">import</span> <span class="n">View</span><span class="p">,</span> <span class="n">create_view_from_parameters</span><span class="p">,</span> <span class="n">DefaultView</span>


<div class="viewcode-block" id="Parse"><a class="viewcode-back" href="../../reference.html#ms3.parse.Parse">[docs]</a><span class="k">class</span> <span class="nc">Parse</span><span class="p">(</span><span class="n">LoggedClass</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class for creating one or several :class:`~.corpus.Corpus` objects and performing actions on all of them.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_deprecated_elements</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;parsed_mscx&quot;</span><span class="p">,</span>
        <span class="s2">&quot;parsed_tsv&quot;</span><span class="p">,</span>
        <span class="s2">&quot;add_detached_annotations&quot;</span><span class="p">,</span>
        <span class="s2">&quot;count_annotation_layers&quot;</span><span class="p">,</span>
        <span class="s2">&quot;count_labels&quot;</span><span class="p">,</span>
        <span class="s2">&quot;get_lists&quot;</span><span class="p">,</span>
        <span class="s2">&quot;iter&quot;</span><span class="p">,</span>
        <span class="s2">&quot;parse_mscx&quot;</span><span class="p">,</span>
        <span class="s2">&quot;pieces&quot;</span><span class="p">,</span>
        <span class="s2">&quot;store_scores&quot;</span><span class="p">,</span>
        <span class="s2">&quot;update_metadata&quot;</span><span class="p">,</span>
    <span class="p">]</span>

<div class="viewcode-block" id="Parse.__init__"><a class="viewcode-back" href="../../reference.html#ms3.parse.Parse.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">directory</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Collection</span><span class="p">[</span><span class="nb">str</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">recursive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                 <span class="n">only_metadata_fnames</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                 <span class="n">include_convertible</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                 <span class="n">include_tsv</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                 <span class="n">exclude_review</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                 <span class="n">file_re</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">Pattern</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">folder_re</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">Pattern</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">exclude_re</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">Pattern</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">file_paths</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Collection</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">labels_cfg</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span>
                 <span class="n">ms</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="o">**</span><span class="n">logger_cfg</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Initialize a Parse object and try to create corpora if directories and/or file paths are specified.</span>

<span class="sd">        Args:</span>
<span class="sd">          directory: Path to scan for corpora.</span>
<span class="sd">          recursive: Pass False if you don&#39;t want to scan ``directory`` for subcorpora, but force making it a corpus instead.</span>
<span class="sd">          only_metadata_fnames:</span>
<span class="sd">              The default view excludes piece names that are not listed in the corpus&#39; metadata.tsv file (e.g. when none was found).</span>
<span class="sd">              Pass False to include all pieces regardless. This might be needed when setting ``recursive`` to False.</span>
<span class="sd">          include_convertible:</span>
<span class="sd">              The default view excludes scores that would need conversion to MuseScore format prior to parsing.</span>
<span class="sd">              Pass True to include convertible scores in .musicxml, .midi, .cap or any other format that MuseScore 3 can open.</span>
<span class="sd">              For on-the-fly conversion, however, the parameter ``ms`` needs to be set.</span>
<span class="sd">          include_tsv: The default view includes TSV files. Pass False to disregard them and parse only scores.</span>
<span class="sd">          exclude_review:</span>
<span class="sd">              The default view excludes files and folders whose name contains &#39;review&#39;.</span>
<span class="sd">              Pass False to include these as well.</span>
<span class="sd">          file_re: Pass a regular expression if you want to create a view filtering out all files that do not contain it.</span>
<span class="sd">          folder_re: Pass a regular expression if you want to create a view filtering out all folders that do not contain it.</span>
<span class="sd">          exclude_re: Pass a regular expression if you want to create a view filtering out all files or folders that contain it.</span>
<span class="sd">          file_paths:</span>
<span class="sd">              If ``directory`` is specified, the file names of these paths are used to create a filtering view excluding all other files.</span>
<span class="sd">              Otherwise, all paths are expected to be part of the same parent corpus which will be inferred from the first path by looking for the first parent directory that</span>
<span class="sd">              either contains a &#39;metadata.tsv&#39; file or is a git. This parameter is deprecated and ``file_re`` should be used instead.</span>
<span class="sd">          labels_cfg: Pass a configuration dict to detect only certain labels or change their output format.</span>
<span class="sd">          ms:</span>
<span class="sd">              If you pass the path to your local MuseScore 3 installation, ms3 will attempt to parse musicXML, MuseScore 2,</span>
<span class="sd">              and other formats by temporarily converting them. If you&#39;re using the standard path, you may try &#39;auto&#39;, or &#39;win&#39; for</span>
<span class="sd">              Windows, &#39;mac&#39; for MacOS, or &#39;mscore&#39; for Linux. In case you do not pass the &#39;file_re&#39; and the MuseScore executable is</span>
<span class="sd">              detected, all convertible files are automatically selected, otherwise only those that can be parsed without conversion.</span>
<span class="sd">          **logger_cfg: Keyword arguments for changing the logger configuration. E.g. ``level=&#39;d&#39;`` to see all debug messages.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s1">&#39;level&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">logger_cfg</span> <span class="ow">or</span> <span class="p">(</span><span class="n">logger_cfg</span><span class="p">[</span><span class="s1">&#39;level&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">logger_cfg</span><span class="p">[</span><span class="s1">&#39;level&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;w&#39;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">subclass</span><span class="o">=</span><span class="s1">&#39;Parse&#39;</span><span class="p">,</span> <span class="n">logger_cfg</span><span class="o">=</span><span class="n">logger_cfg</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">corpus_paths</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;{corpus_name -&gt; path} dictionary with each corpus&#39;s base directory. Generally speaking, each corpus path is expected to contain a ``metadata.tsv`` and, maybe, to be a git.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">corpus_objects</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Corpus</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;{corpus_name -&gt; Corpus} dictionary with one object per :attr:`corpus_path &lt;corpus_paths&gt;`.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_ms</span> <span class="o">=</span> <span class="n">get_musescore</span><span class="p">(</span><span class="n">ms</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_views</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">initial_view</span> <span class="o">=</span> <span class="n">create_view_from_parameters</span><span class="p">(</span><span class="n">only_metadata_fnames</span><span class="o">=</span><span class="n">only_metadata_fnames</span><span class="p">,</span>
                                                   <span class="n">include_convertible</span><span class="o">=</span><span class="n">include_convertible</span><span class="p">,</span>
                                                   <span class="n">include_tsv</span><span class="o">=</span><span class="n">include_tsv</span><span class="p">,</span>
                                                   <span class="n">exclude_review</span><span class="o">=</span><span class="n">exclude_review</span><span class="p">,</span>
                                                   <span class="n">file_paths</span><span class="o">=</span><span class="n">file_paths</span><span class="p">,</span>
                                                   <span class="n">file_re</span><span class="o">=</span><span class="n">file_re</span><span class="p">,</span>
                                                   <span class="n">folder_re</span><span class="o">=</span><span class="n">folder_re</span><span class="p">,</span>
                                                   <span class="n">exclude_re</span><span class="o">=</span><span class="n">exclude_re</span><span class="p">,</span>
                                                   <span class="n">level</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">getEffectiveLevel</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_views</span><span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="n">initial_view</span>
        <span class="k">if</span> <span class="n">initial_view</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="s1">&#39;default&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_views</span><span class="p">[</span><span class="s1">&#39;default&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">DefaultView</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">getEffectiveLevel</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_views</span><span class="p">[</span><span class="s1">&#39;all&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">View</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">getEffectiveLevel</span><span class="p">())</span>
        <span class="c1">#</span>
        <span class="c1"># self._ignored_warnings = defaultdict(list)</span>
        <span class="c1"># &quot;&quot;&quot;:obj:`collections.defaultdict`</span>
        <span class="c1"># {&#39;logger_name&#39; -&gt; [(message_id), ...]} This dictionary stores the warnings to be ignored</span>
        <span class="c1"># upon loading them from an IGNORED_WARNINGS file.</span>
        <span class="c1"># &quot;&quot;&quot;</span>
        <span class="c1">#</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labels_cfg</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;staff&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s1">&#39;voice&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s1">&#39;harmony_layer&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s1">&#39;positioning&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s1">&#39;decode&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s1">&#39;column_name&#39;</span><span class="p">:</span> <span class="s1">&#39;label&#39;</span><span class="p">,</span>
            <span class="s1">&#39;color_format&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
        <span class="p">}</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;:obj:`dict`</span>
<span class="sd">        Configuration dictionary to determine the output format of :py:attr:`~.score.Score.labels` and</span>
<span class="sd">        :py:attr:`~.score.Score.expanded` tables. The dictonary is passed to :py:attr:`~.score.Score` upon parsing.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labels_cfg</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">update_labels_cfg</span><span class="p">(</span><span class="n">labels_cfg</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">directory</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">directory</span> <span class="o">=</span> <span class="p">[</span><span class="n">directory</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">directory</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_dir</span><span class="p">(</span><span class="n">directory</span><span class="o">=</span><span class="n">d</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="n">recursive</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">file_paths</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_files</span><span class="p">(</span><span class="n">file_paths</span><span class="p">)</span></div>
    <span class="c1">#%%%%%%%%%%%%%%%%%%%%%%%%%%%%% END of __init__() %%%%%%%%%%%%%%%%%%%%%%%%%%%%%#</span>
    <span class="c1">#%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%#</span>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">ms</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Path or command of the local MuseScore 3 installation if specified by the user and recognized.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ms</span>

    <span class="nd">@ms</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">ms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ms</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="s1">&#39;win&#39;</span><span class="p">,</span> <span class="s1">&#39;mac&#39;</span><span class="p">]]):</span>
        <span class="n">executable</span> <span class="o">=</span> <span class="n">get_musescore</span><span class="p">(</span><span class="n">ms</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">executable</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">ms</span><span class="si">}</span><span class="s2">&#39; did not lead me to a MuseScore executable.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">executable</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ms</span> <span class="o">=</span> <span class="n">executable</span>
            <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">corpus</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__iter__</span><span class="p">():</span>
                <span class="n">corpus</span><span class="o">.</span><span class="n">ms</span> <span class="o">=</span> <span class="n">executable</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">n_detected</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Number of detected files aggregated from all :class:`~.corpus.Corpus` objects without taking views into account. Excludes metadata files.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">corpus</span><span class="o">.</span><span class="n">n_detected</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">corpus</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">n_orphans</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Number of files that are always disregarded because they could not be attributed to any of the fnames.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">corpus</span><span class="o">.</span><span class="n">ix2orphan_file</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">corpus</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">n_parsed</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Number of parsed files aggregated from all :class:`~.corpus.Corpus` objects without taking views into account. Excludes metadata files.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">corpus</span><span class="o">.</span><span class="n">n_parsed</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">corpus</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">n_parsed_scores</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Number of parsed scores aggregated from all :class:`~.corpus.Corpus` objects without taking views into account. Excludes metadata files.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">corpus</span><span class="o">.</span><span class="n">n_parsed_scores</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">corpus</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">n_parsed_tsvs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Number of parsed TSV files aggregated from all :class:`~.corpus.Corpus` objects without taking views into account. Excludes metadata files.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">corpus</span><span class="o">.</span><span class="n">n_parsed_tsvs</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">corpus</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">n_pieces</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Number of all available pieces (&#39;fnames&#39;), independent of the view.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">corpus</span><span class="o">.</span><span class="n">n_pieces</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">corpus</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">n_unparsed_scores</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Number of all detected but not yet parsed scores, aggregated from all :class:`~.corpus.Corpus` objects without taking views into account. Excludes metadata files.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">corpus</span><span class="o">.</span><span class="n">n_unparsed_scores</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">corpus</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">n_unparsed_tsvs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Number of all detected but not yet parsed TSV files, aggregated from all :class:`~.corpus.Corpus` objects without taking views into account. Excludes metadata files.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">corpus</span><span class="o">.</span><span class="n">n_unparsed_tsvs</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">corpus</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">)</span>




    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">view</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">View</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieve the current View object. Shorthand for :meth:`get_view`.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_view</span><span class="p">()</span>

    <span class="nd">@view</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">view</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_view</span><span class="p">:</span> <span class="n">View</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">new_view</span><span class="p">,</span> <span class="n">View</span><span class="p">):</span>
            <span class="k">return</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;If you want to switch to an existing view, use its name like an attribute or &quot;</span>
                             <span class="s2">&quot;call _.switch_view().&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_view</span><span class="p">(</span><span class="n">new_view</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">views</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Display a short description of the available views.&quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">pretty_dict</span><span class="p">({</span><span class="s2">&quot;[active]&quot;</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_views</span><span class="o">.</span><span class="n">items</span><span class="p">()},</span> <span class="s2">&quot;view_name&quot;</span><span class="p">,</span> <span class="s2">&quot;Description&quot;</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">view_name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the name of the active view.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_view</span><span class="p">()</span><span class="o">.</span><span class="n">name</span>

    <span class="nd">@view_name</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">view_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_name</span><span class="p">):</span>
        <span class="n">view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_view</span><span class="p">()</span>
        <span class="n">view</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">new_name</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">view_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">view</span><span class="o">.</span><span class="n">name</span> <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">name</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">view</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_views</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

<div class="viewcode-block" id="Parse.add_corpus"><a class="viewcode-back" href="../../reference.html#ms3.parse.Parse.add_corpus">[docs]</a>    <span class="k">def</span> <span class="nf">add_corpus</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                   <span class="n">directory</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                   <span class="n">corpus_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                   <span class="n">only_metadata_fnames</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                   <span class="n">include_convertible</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                   <span class="n">include_tsv</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                   <span class="n">exclude_review</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                   <span class="n">file_re</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">Pattern</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                   <span class="n">folder_re</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">Pattern</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                   <span class="n">exclude_re</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">Pattern</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                   <span class="n">paths</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Collection</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                   <span class="o">**</span><span class="n">logger_cfg</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method creates a :class:`~.corpus.Corpus` object which scans the directory ``directory`` for parseable files.</span>
<span class="sd">        It inherits all :class:`Views &lt;.view.View&gt;` from the Parse object.</span>

<span class="sd">        Args:</span>
<span class="sd">            directory: Directory to scan for files.</span>
<span class="sd">            corpus_name:</span>
<span class="sd">                By default, the folder name of ``directory`` is used as name for this corpus. Pass a string to</span>
<span class="sd">                use a different identifier.</span>
<span class="sd">            **logger_cfg:</span>
<span class="sd">                Keyword arguments for configuring the logger of the new Corpus object. E.g. ``level=&#39;d&#39;`` to see all debug messages.</span>
<span class="sd">                Note that the logger is a child logger of this Parse object&#39;s logger and propagates, so it might filter debug messages.</span>
<span class="sd">                You can use _.change_logger_cfg(level=&#39;d&#39;) to change the level post hoc.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">directory</span> <span class="o">=</span> <span class="n">resolve_dir</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">directory</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">directory</span><span class="si">}</span><span class="s2"> is not an existing directory.&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="n">new_logger_cfg</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logger_cfg</span><span class="p">)</span>
        <span class="n">new_logger_cfg</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">logger_cfg</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">corpus_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">corpus_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\/&quot;</span><span class="p">)</span>
        <span class="n">logger_cfg</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">corpus_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">view_params</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span><span class="n">param</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="p">(</span><span class="n">paths</span><span class="p">,</span> <span class="n">file_re</span><span class="p">,</span> <span class="n">folder_re</span><span class="p">,</span> <span class="n">exclude_re</span><span class="p">,</span> <span class="n">only_metadata_fnames</span><span class="p">,</span> <span class="n">include_tsv</span><span class="p">,</span> <span class="n">exclude_review</span><span class="p">,</span> <span class="n">include_convertible</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">view_params</span><span class="p">:</span>
            <span class="n">initial_view</span> <span class="o">=</span> <span class="n">create_view_from_parameters</span><span class="p">(</span><span class="n">only_metadata_fnames</span><span class="o">=</span><span class="n">only_metadata_fnames</span><span class="p">,</span>
                                                       <span class="n">include_convertible</span><span class="o">=</span><span class="n">include_convertible</span><span class="p">,</span>
                                                       <span class="n">include_tsv</span><span class="o">=</span><span class="n">include_tsv</span><span class="p">,</span>
                                                       <span class="n">exclude_review</span><span class="o">=</span><span class="n">exclude_review</span><span class="p">,</span>
                                                       <span class="n">file_paths</span><span class="o">=</span><span class="n">paths</span><span class="p">,</span>
                                                       <span class="n">file_re</span><span class="o">=</span><span class="n">file_re</span><span class="p">,</span>
                                                       <span class="n">folder_re</span><span class="o">=</span><span class="n">folder_re</span><span class="p">,</span>
                                                       <span class="n">exclude_re</span><span class="o">=</span><span class="n">exclude_re</span><span class="p">,</span>
                                                       <span class="n">level</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">getEffectiveLevel</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_views</span><span class="p">[</span><span class="n">initial_view</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">initial_view</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">initial_view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_view</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">corpus</span> <span class="o">=</span> <span class="n">Corpus</span><span class="p">(</span><span class="n">directory</span><span class="o">=</span><span class="n">directory</span><span class="p">,</span> <span class="n">view</span><span class="o">=</span><span class="n">initial_view</span><span class="p">,</span> <span class="n">labels_cfg</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">labels_cfg</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="p">,</span> <span class="o">**</span><span class="n">logger_cfg</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AssertionError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">directory</span><span class="si">}</span><span class="s2"> contains no parseable files.&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="n">corpus</span><span class="o">.</span><span class="n">set_view</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="n">view_name</span><span class="p">:</span> <span class="n">view</span> <span class="k">for</span> <span class="n">view_name</span><span class="p">,</span> <span class="n">view</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_views</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">view_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">})</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">corpus</span><span class="o">.</span><span class="n">files</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No parseable files detected in </span><span class="si">{</span><span class="n">directory</span><span class="si">}</span><span class="s2">. Skipping...&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">corpus_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">corpus_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\/&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">corpus_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">corpus_paths</span><span class="p">:</span>
            <span class="n">existing_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">corpus_paths</span><span class="p">[</span><span class="n">corpus_name</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">existing_path</span> <span class="o">==</span> <span class="n">directory</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Corpus &#39;</span><span class="si">{</span><span class="n">corpus_name</span><span class="si">}</span><span class="s2">&#39; had already been present and was overwritten, i.e., reset.&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Corpus &#39;</span><span class="si">{</span><span class="n">corpus_name</span><span class="si">}</span><span class="s2">&#39; had already been present for the path </span><span class="si">{</span><span class="n">existing_path</span><span class="si">}</span><span class="s2"> and &quot;</span>
                                    <span class="sa">f</span><span class="s2">&quot;was replaced by </span><span class="si">{</span><span class="n">directory</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">corpus_paths</span><span class="p">[</span><span class="n">corpus_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">directory</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">corpus_objects</span><span class="p">[</span><span class="n">corpus_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">corpus</span></div>




<div class="viewcode-block" id="Parse.add_dir"><a class="viewcode-back" href="../../reference.html#ms3.parse.Parse.add_dir">[docs]</a>    <span class="k">def</span> <span class="nf">add_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                <span class="n">recursive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                <span class="n">only_metadata_fnames</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                <span class="n">include_convertible</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                <span class="n">include_tsv</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                <span class="n">exclude_review</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                <span class="n">file_re</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">Pattern</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                <span class="n">folder_re</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">Pattern</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                <span class="n">exclude_re</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">Pattern</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                <span class="n">paths</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Collection</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                <span class="o">**</span><span class="n">logger_cfg</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method decides if the directory ``directory`` contains several corpora or if it is a corpus</span>
<span class="sd">        itself, and calls :meth:`add_corpus` for each corpus.</span>

<span class="sd">        Args:</span>
<span class="sd">            directory: Directory to scan for corpora.</span>
<span class="sd">            recursive:</span>
<span class="sd">                By default, if any of the first-level subdirectories contains a &#39;metadata.tsv&#39; or is a git, all first-level</span>
<span class="sd">                subdirectories of ``directory`` are treated as corpora, i.e. one :class:`~.corpus.Corpus` object per folder is created.</span>
<span class="sd">                Pass False to prevent this, which is equivalent to calling :meth:`add_corpus(directory) &lt;add_corpus&gt;`</span>
<span class="sd">            **logger_cfg:</span>
<span class="sd">                Keyword arguments for configuring the logger of the new Corpus objects. E.g. ``level=&#39;d&#39;`` to see all debug messages.</span>
<span class="sd">                Note that the loggers are child loggers of this Parse object&#39;s logger and propagate, so it might filter debug messages.</span>
<span class="sd">                You can use _.change_logger_cfg(level=&#39;d&#39;) to change the level post hoc.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">directory</span> <span class="o">=</span> <span class="n">resolve_dir</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">directory</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">directory</span><span class="si">}</span><span class="s2"> is not an existing directory.&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="n">L</span> <span class="o">=</span> <span class="nb">locals</span><span class="p">()</span>
        <span class="n">arguments</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;only_metadata_fnames&#39;</span><span class="p">,</span> <span class="s1">&#39;include_convertible&#39;</span><span class="p">,</span> <span class="s1">&#39;include_tsv&#39;</span><span class="p">,</span> <span class="s1">&#39;exclude_review&#39;</span><span class="p">,</span> <span class="s1">&#39;file_re&#39;</span><span class="p">,</span> <span class="s1">&#39;folder_re&#39;</span><span class="p">,</span> <span class="s1">&#39;exclude_re&#39;</span><span class="p">,</span> <span class="s1">&#39;paths&#39;</span><span class="p">)</span>
        <span class="n">corpus_config</span> <span class="o">=</span> <span class="p">{</span><span class="n">arg</span><span class="p">:</span> <span class="n">L</span><span class="p">[</span><span class="n">arg</span><span class="p">]</span> <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">arguments</span> <span class="k">if</span> <span class="n">L</span><span class="p">[</span><span class="n">arg</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">}</span>
        <span class="k">if</span> <span class="s1">&#39;level&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">logger_cfg</span><span class="p">:</span>
            <span class="n">logger_cfg</span><span class="p">[</span><span class="s1">&#39;level&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">getEffectiveLevel</span><span class="p">()</span>
        <span class="n">corpus_config</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">logger_cfg</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">recursive</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_corpus</span><span class="p">(</span><span class="n">directory</span><span class="o">=</span><span class="n">directory</span><span class="p">,</span>
                            <span class="o">**</span><span class="n">corpus_config</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># new corpus/corpora to be added</span>
        <span class="n">subdir_corpora</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">get_first_level_corpora</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">))</span>
        <span class="n">n_corpora</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">subdir_corpora</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">n_corpora</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Treating </span><span class="si">{</span><span class="n">directory</span><span class="si">}</span><span class="s2"> as corpus.&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_corpus</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span>
                            <span class="o">**</span><span class="n">corpus_config</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">n_corpora</span><span class="si">}</span><span class="s2"> individual corpora detected in </span><span class="si">{</span><span class="n">directory</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">corpus_path</span> <span class="ow">in</span> <span class="n">subdir_corpora</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_corpus</span><span class="p">(</span><span class="n">corpus_path</span><span class="p">,</span>
                                <span class="o">**</span><span class="n">corpus_config</span><span class="p">)</span></div>


<div class="viewcode-block" id="Parse.add_files"><a class="viewcode-back" href="../../reference.html#ms3.parse.Parse.add_files">[docs]</a>    <span class="k">def</span> <span class="nf">add_files</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_paths</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Collection</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span> <span class="n">corpus_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Deprecated: To deal with particular files only, use :meth:`add_corpus` passing the directory containing them and</span>
<span class="sd">        configure the :class`~.view.View` accordingly. This method here does it for you but easily leads to unexpected behaviour.</span>
<span class="sd">        It expects the file paths to point to files located in a shared corpus folder</span>
<span class="sd">        on some higher level or in folders for which :class:`~.corpus.Corpus` objects have already been created.</span>

<span class="sd">        Args:</span>
<span class="sd">            file_paths: Collection of file paths. Only existing files can be added.</span>
<span class="sd">            corpus_name:</span>

<span class="sd">                * By default, I will try to attribute the files to existing :class:`~.corpus.Corpus` objects based on their paths. This makes sense only when new files have</span>
<span class="sd">                  been created after the directories were scanned.</span>
<span class="sd">                * For paths that do no not contain an existing corpus_path, I will try to detect the parent directory that is a corpus (based on it being a git or containing a ``metadata.tsv``).</span>
<span class="sd">                  If this is without success for the first path, I will raise an error. Otherwise, all subsequent paths will be considered to be part of that same corpus (watch out</span>
<span class="sd">                  meaningless relative paths!).</span>
<span class="sd">                * You can pass a folder name contained in the first path to create a new corpus, assuming that all other paths are contained in it (watch out meaningless relative paths!).</span>
<span class="sd">                * Pass an existing corpus_name to add the files to a particular corpus. Note that all parseable files under the corpus_path are detected anyway, and if you add files</span>
<span class="sd">                  from other directories, it will lead to invalid relative paths that work only on your system. If you&#39;re adding files that have been created after the Corpus object</span>
<span class="sd">                  has, you can leave this parameter empty; paths will be attributed to the existing corpora automatically.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">resolved_paths</span> <span class="o">=</span> <span class="n">resolve_paths_argument</span><span class="p">(</span><span class="n">file_paths</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">resolved_paths</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">corpus_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">add_to_existing</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
            <span class="n">no_parent</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">resolved_paths</span><span class="p">:</span>
                <span class="n">part_of</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">for</span> <span class="n">corpus_name</span><span class="p">,</span> <span class="n">corpus_path</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">corpus_paths</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">corpus_path</span> <span class="ow">in</span> <span class="n">path</span><span class="p">:</span>
                        <span class="n">part_of</span> <span class="o">=</span> <span class="n">corpus_name</span>
                        <span class="n">add_to_existing</span><span class="p">[</span><span class="n">part_of</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
                        <span class="k">break</span>
                <span class="k">if</span> <span class="n">part_of</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">no_parent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">corpus_name</span><span class="p">,</span> <span class="n">file_paths</span> <span class="ow">in</span> <span class="n">add_to_existing</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">get_corpus</span><span class="p">(</span><span class="n">corpus_name</span><span class="p">)</span><span class="o">.</span><span class="n">add_file_paths</span><span class="p">(</span><span class="n">file_paths</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">no_parent</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># paths are expected to be contained in one and the same corpus directory</span>
                <span class="n">first_path</span> <span class="o">=</span> <span class="n">no_parent</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">directory</span> <span class="o">=</span> <span class="n">path2parent_corpus</span><span class="p">(</span><span class="n">first_path</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">directory</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No parent of </span><span class="si">{</span><span class="n">first_path</span><span class="si">}</span><span class="s2"> has been recognized as a corpus by being a git or containing a &#39;metadata.tsv&#39;. Use _.add_corpus()&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_corpus</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">corpus_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">corpus_paths</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_corpus</span><span class="p">(</span><span class="n">corpus_name</span><span class="p">)</span><span class="o">.</span><span class="n">add_file_paths</span><span class="p">(</span><span class="n">file_paths</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># find the path according to the corpus_name</span>
            <span class="n">first_path</span> <span class="o">=</span> <span class="n">resolved_paths</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">corpus_name</span> <span class="ow">in</span> <span class="n">first_path</span><span class="p">:</span>
                <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="n">tmp_path</span><span class="p">,</span> <span class="n">last_component</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">first_path</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">tmp_path</span> <span class="o">==</span> <span class="n">first_path</span><span class="p">:</span>
                        <span class="c1"># reached the root</span>
                        <span class="n">first_path</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                        <span class="k">break</span>
                    <span class="k">if</span> <span class="n">last_component</span> <span class="o">==</span> <span class="n">corpus_name</span><span class="p">:</span>
                        <span class="c1"># first_path is the corpus first_path</span>
                        <span class="k">break</span>
                    <span class="n">first_path</span> <span class="o">=</span> <span class="n">tmp_path</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">first_path</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span>
            <span class="k">if</span> <span class="n">first_path</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;corpus_name needs to be a folder contained in the first path, but &#39;</span><span class="si">{</span><span class="n">corpus_name</span><span class="si">}</span><span class="s2">&#39; isn&#39;t.&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_corpus</span><span class="p">(</span><span class="n">first_path</span><span class="p">)</span></div>
            <span class="c1"># corpus = self.get_corpus(corpus_name)</span>
            <span class="c1"># new_view = create_view_from_parameters(only_metadata_fnames=False, exclude_review=False, paths=paths)</span>
            <span class="c1"># corpus.set_view(new_view)</span>

    <span class="k">def</span> <span class="nf">color_non_chord_tones</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                              <span class="n">color_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;red&#39;</span><span class="p">,</span>
                              <span class="n">view_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                              <span class="n">force</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                              <span class="n">choose</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="s1">&#39;ask&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="n">CorpusFnameTuple</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">FileDataframeTuple</span><span class="p">]]:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">corpus_name</span><span class="p">,</span> <span class="n">corpus</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter_corpora</span><span class="p">(</span><span class="n">view_name</span><span class="p">):</span>
            <span class="n">fname2reports</span> <span class="o">=</span> <span class="n">corpus</span><span class="o">.</span><span class="n">color_non_chord_tones</span><span class="p">(</span><span class="n">color_name</span><span class="p">,</span>
                                                    <span class="n">view_name</span><span class="o">=</span><span class="n">view_name</span><span class="p">,</span>
                                                    <span class="n">force</span><span class="o">=</span><span class="n">force</span><span class="p">,</span>
                                                    <span class="n">choose</span><span class="o">=</span><span class="n">choose</span><span class="p">)</span>
            <span class="n">result</span><span class="o">.</span><span class="n">update</span><span class="p">({(</span><span class="n">corpus_name</span><span class="p">,</span> <span class="n">fname</span><span class="p">):</span> <span class="n">report</span> <span class="k">for</span> <span class="n">fname</span><span class="p">,</span> <span class="n">report</span> <span class="ow">in</span> <span class="n">fname2reports</span><span class="o">.</span><span class="n">items</span><span class="p">()})</span>
        <span class="k">return</span> <span class="n">result</span>

<div class="viewcode-block" id="Parse.change_labels_cfg"><a class="viewcode-back" href="../../reference.html#ms3.parse.Parse.change_labels_cfg">[docs]</a>    <span class="k">def</span> <span class="nf">change_labels_cfg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">labels_cfg</span><span class="o">=</span><span class="p">{},</span> <span class="n">staff</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">voice</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">harmony_layer</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">positioning</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">decode</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">column_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">color_format</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Update :obj:`Parse.labels_cfg` and retrieve new &#39;labels&#39; tables accordingly.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        labels_cfg : :obj:`dict`</span>
<span class="sd">            Using an entire dictionary or, to change only particular options, choose from:</span>
<span class="sd">        staff, voice, harmony_layer, positioning, decode, column_name</span>
<span class="sd">            Arguments as they will be passed to :py:meth:`~ms3.annotations.Annotations.get_labels`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;staff&#39;</span><span class="p">,</span> <span class="s1">&#39;voice&#39;</span><span class="p">,</span> <span class="s1">&#39;harmony_layer&#39;</span><span class="p">,</span> <span class="s1">&#39;positioning&#39;</span><span class="p">,</span> <span class="s1">&#39;decode&#39;</span><span class="p">,</span> <span class="s1">&#39;column_name&#39;</span><span class="p">,</span> <span class="s1">&#39;color_format&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
            <span class="n">val</span> <span class="o">=</span> <span class="nb">locals</span><span class="p">()[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">labels_cfg</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
        <span class="n">updated</span> <span class="o">=</span> <span class="n">update_labels_cfg</span><span class="p">(</span><span class="n">labels_cfg</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labels_cfg</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">updated</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">score</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parsed_mscx</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">score</span><span class="o">.</span><span class="n">change_labels_cfg</span><span class="p">(</span><span class="n">labels_cfg</span><span class="o">=</span><span class="n">updated</span><span class="p">)</span>
        <span class="n">ids</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_labellists</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ids</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_extract_and_cache_dataframes</span><span class="p">(</span><span class="n">ids</span><span class="o">=</span><span class="n">ids</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="Parse.compare_labels"><a class="viewcode-back" href="../../reference.html#ms3.parse.Parse.compare_labels">[docs]</a>    <span class="k">def</span> <span class="nf">compare_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                       <span class="n">key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;detached&#39;</span><span class="p">,</span>
                       <span class="n">new_color</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;ms3_darkgreen&#39;</span><span class="p">,</span>
                       <span class="n">old_color</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;ms3_darkred&#39;</span><span class="p">,</span>
                       <span class="n">detached_is_newer</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                       <span class="n">add_to_rna</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                       <span class="n">view_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Compare detached labels ``key`` to the ones attached to the Score to create a diff.</span>
<span class="sd">        By default, the attached labels are considered as the reviewed version and labels that have changed or been added</span>
<span class="sd">        in comparison to the detached labels are colored in green; whereas the previous versions of changed labels are</span>
<span class="sd">        attached to the Score in red, just like any deleted label.</span>

<span class="sd">        Args:</span>
<span class="sd">            key: Key of the detached labels you want to compare to the ones in the score.</span>
<span class="sd">            new_color, old_color:</span>
<span class="sd">                The colors by which new and old labels are differentiated. Identical labels remain unchanged. Colors can be</span>
<span class="sd">                CSS colors or MuseScore colors (see :py:attr:`utils.MS3_COLORS`).</span>
<span class="sd">            detached_is_newer:</span>
<span class="sd">                Pass True if the detached labels are to be added with ``new_color`` whereas the attached changed labels</span>
<span class="sd">                will turn ``old_color``, as opposed to the default.</span>
<span class="sd">            add_to_rna:</span>
<span class="sd">                By default, new labels are attached to the Roman Numeral layer.</span>
<span class="sd">                Pass False to attach them to the chord layer instead.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Number of scores in which labels have changed.</span>
<span class="sd">            Number of scores in which no label has chnged.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">changed</span><span class="p">,</span> <span class="n">unchanged</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">corpus</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter_corpora</span><span class="p">(</span><span class="n">view_name</span><span class="o">=</span><span class="n">view_name</span><span class="p">):</span>
            <span class="n">c</span><span class="p">,</span> <span class="n">u</span> <span class="o">=</span> <span class="n">corpus</span><span class="o">.</span><span class="n">compare_labels</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span>
                                        <span class="n">new_color</span><span class="o">=</span><span class="n">new_color</span><span class="p">,</span>
                                        <span class="n">old_color</span><span class="o">=</span><span class="n">old_color</span><span class="p">,</span>
                                        <span class="n">detached_is_newer</span><span class="o">=</span><span class="n">detached_is_newer</span><span class="p">,</span>
                                        <span class="n">add_to_rna</span><span class="o">=</span><span class="n">add_to_rna</span><span class="p">,</span>
                                        <span class="n">view_name</span><span class="o">=</span><span class="n">view_name</span><span class="p">)</span>
            <span class="n">changed</span> <span class="o">+=</span> <span class="n">c</span>
            <span class="n">unchanged</span> <span class="o">+=</span> <span class="n">u</span>
        <span class="k">return</span> <span class="n">changed</span><span class="p">,</span> <span class="n">unchanged</span></div>


    <span class="k">def</span> <span class="nf">count_changed_scores</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">view_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">corpus</span><span class="o">.</span><span class="n">count_changed_scores</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">corpus</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter_corpora</span><span class="p">(</span><span class="n">view_name</span><span class="p">))</span>

<div class="viewcode-block" id="Parse.count_extensions"><a class="viewcode-back" href="../../reference.html#ms3.parse.Parse.count_extensions">[docs]</a>    <span class="k">def</span> <span class="nf">count_extensions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                         <span class="n">view_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                         <span class="n">per_piece</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                         <span class="n">include_metadata</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                         <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Count file extensions.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        keys : :obj:`str` or :obj:`~collections.abc.Collection`, optional</span>
<span class="sd">            Key(s) for which to count file extensions.  By default, all keys are selected.</span>
<span class="sd">        ids : :obj:`~collections.abc.Collection`</span>
<span class="sd">            If you pass a collection of IDs, ``keys`` is ignored and only the selected extensions are counted.</span>
<span class="sd">        per_key : :obj:`bool`, optional</span>
<span class="sd">            If set to True, the results are returned as a dict {key: Counter},</span>
<span class="sd">            otherwise the counts are summed up in one Counter.</span>
<span class="sd">        per_subdir : :obj:`bool`, optional</span>
<span class="sd">            If set to True, the results are returned as {key: {subdir: Counter} }. ``per_key=True`` is therefore implied.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        :obj:`dict`</span>
<span class="sd">            By default, the function returns a Counter of file extensions (Counters are converted to dicts).</span>
<span class="sd">            If ``per_key`` is set to True, a dictionary {key: Counter} is returned, separating the counts.</span>
<span class="sd">            If ``per_subdir`` is set to True, a dictionary {key: {subdir: Counter} } is returned.</span>

<span class="sd">        Args:</span>
<span class="sd">            view_name:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">extension_counters</span> <span class="o">=</span> <span class="p">{</span><span class="n">corpus_name</span><span class="p">:</span> <span class="n">corpus</span><span class="o">.</span><span class="n">count_extensions</span><span class="p">(</span><span class="n">view_name</span><span class="p">,</span> <span class="n">include_metadata</span><span class="o">=</span><span class="n">include_metadata</span><span class="p">)</span> <span class="k">for</span> <span class="n">corpus_name</span><span class="p">,</span> <span class="n">corpus</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter_corpora</span><span class="p">(</span><span class="n">view_name</span><span class="p">)}</span>
        <span class="k">if</span> <span class="n">per_piece</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{(</span><span class="n">corpus_name</span><span class="p">,</span> <span class="n">fname</span><span class="p">):</span> <span class="nb">dict</span><span class="p">(</span><span class="n">cnt</span><span class="p">)</span> <span class="k">for</span> <span class="n">corpus_name</span><span class="p">,</span> <span class="n">fname2cnt</span> <span class="ow">in</span> <span class="n">extension_counters</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">for</span> <span class="n">fname</span><span class="p">,</span> <span class="n">cnt</span> <span class="ow">in</span> <span class="n">fname2cnt</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">corpus_name</span><span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">fname2cnt</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">Counter</span><span class="p">()))</span> <span class="k">for</span> <span class="n">corpus_name</span><span class="p">,</span> <span class="n">fname2cnt</span> <span class="ow">in</span> <span class="n">extension_counters</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span></div>


    <span class="k">def</span> <span class="nf">count_files</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                    <span class="n">detected</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">parsed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">as_dict</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                    <span class="n">drop_zero</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                    <span class="n">view_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]:</span>
        <span class="n">all_counts</span> <span class="o">=</span> <span class="p">{</span><span class="n">corpus_name</span><span class="p">:</span> <span class="n">corpus</span><span class="o">.</span><span class="n">_summed_file_count</span><span class="p">(</span><span class="n">types</span><span class="o">=</span><span class="n">detected</span><span class="p">,</span> <span class="n">parsed</span><span class="o">=</span><span class="n">parsed</span><span class="p">,</span> <span class="n">view_name</span><span class="o">=</span><span class="n">view_name</span><span class="p">)</span> <span class="k">for</span> <span class="n">corpus_name</span><span class="p">,</span> <span class="n">corpus</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter_corpora</span><span class="p">(</span><span class="n">view_name</span><span class="o">=</span><span class="n">view_name</span><span class="p">)}</span>
        <span class="n">counts_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">all_counts</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;Int64&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">drop_zero</span><span class="p">:</span>
            <span class="n">empty_cols</span> <span class="o">=</span> <span class="n">counts_df</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">counts_df</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">counts_df</span> <span class="o">=</span> <span class="n">counts_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">empty_cols</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">as_dict</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">counts_df</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">orient</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">)</span>
        <span class="n">counts_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s1">&#39;corpus&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">counts_df</span>

    <span class="k">def</span> <span class="nf">count_parsed_scores</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">view_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">len</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_parsed_score_files</span><span class="p">(</span><span class="n">view_name</span><span class="o">=</span><span class="n">view_name</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>

    <span class="k">def</span> <span class="nf">count_parsed_tsvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">view_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">len</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_parsed_tsv_files</span><span class="p">(</span><span class="n">view_name</span><span class="o">=</span><span class="n">view_name</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>

    <span class="k">def</span> <span class="nf">count_unparsed_scores</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">view_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">len</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_parsed_score_files</span><span class="p">(</span><span class="n">view_name</span><span class="o">=</span><span class="n">view_name</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>

    <span class="k">def</span> <span class="nf">count_unparsed_tsvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">view_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">len</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_parsed_tsv_files</span><span class="p">(</span><span class="n">view_name</span><span class="o">=</span><span class="n">view_name</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>

    <span class="k">def</span> <span class="nf">create_missing_metadata_tsv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                    <span class="n">view_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">corpus_name</span><span class="p">,</span> <span class="n">corpus</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter_corpora</span><span class="p">(</span><span class="n">view_name</span><span class="o">=</span><span class="n">view_name</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">corpus</span><span class="o">.</span><span class="n">metadata_tsv</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">path</span> <span class="o">=</span> <span class="n">corpus</span><span class="o">.</span><span class="n">create_metadata_tsv</span><span class="p">()</span>

<div class="viewcode-block" id="Parse.disambiguate_facet"><a class="viewcode-back" href="../../reference.html#ms3.parse.Parse.disambiguate_facet">[docs]</a>    <span class="k">def</span> <span class="nf">disambiguate_facet</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                           <span class="n">facet</span><span class="p">:</span> <span class="n">Facet</span><span class="p">,</span>
                           <span class="n">view_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                           <span class="n">ask_for_input</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calls the method on every selected corpus.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">corpus</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter_corpora</span><span class="p">(</span><span class="n">view_name</span><span class="p">):</span>
            <span class="n">corpus</span><span class="o">.</span><span class="n">disambiguate_facet</span><span class="p">(</span><span class="n">facet</span><span class="o">=</span><span class="n">facet</span><span class="p">,</span>
                                      <span class="n">view_name</span><span class="o">=</span><span class="n">view_name</span><span class="p">,</span>
                                      <span class="n">ask_for_input</span><span class="o">=</span><span class="n">ask_for_input</span><span class="p">)</span></div>


    <span class="k">def</span> <span class="nf">extract_facets</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                       <span class="n">facets</span><span class="p">:</span> <span class="n">ScoreFacets</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                       <span class="n">view_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                       <span class="n">force</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                       <span class="n">choose</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="s1">&#39;ask&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;auto&#39;</span><span class="p">,</span>
                       <span class="n">unfold</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                       <span class="n">interval_index</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                       <span class="n">flat</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                       <span class="n">concatenate</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="n">CorpusFnameTuple</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span>  <span class="n">List</span><span class="p">[</span><span class="n">FileDataframeTuple</span><span class="p">]],</span> <span class="n">List</span><span class="p">[</span><span class="n">FileDataframeTuple</span><span class="p">]]]]:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_aggregate_corpus_data</span><span class="p">(</span><span class="s1">&#39;extract_facets&#39;</span><span class="p">,</span>
                                           <span class="n">facets</span><span class="o">=</span><span class="n">facets</span><span class="p">,</span>
                                           <span class="n">view_name</span><span class="o">=</span><span class="n">view_name</span><span class="p">,</span>
                                           <span class="n">force</span><span class="o">=</span><span class="n">force</span><span class="p">,</span>
                                           <span class="n">choose</span><span class="o">=</span><span class="n">choose</span><span class="p">,</span>
                                           <span class="n">unfold</span><span class="o">=</span><span class="n">unfold</span><span class="p">,</span>
                                           <span class="n">interval_index</span><span class="o">=</span><span class="n">interval_index</span><span class="p">,</span>
                                           <span class="n">flat</span><span class="o">=</span><span class="n">flat</span><span class="p">,</span>
                                           <span class="n">concatenate</span><span class="o">=</span><span class="n">concatenate</span><span class="p">,</span>
                                           <span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_all_parsed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">facets</span><span class="p">:</span> <span class="n">FacetArguments</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                       <span class="n">view_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                       <span class="n">force</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                       <span class="n">choose</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="s1">&#39;ask&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;all&#39;</span><span class="p">,</span>
                       <span class="n">flat</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                       <span class="n">include_empty</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                       <span class="n">concatenate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                       <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="n">CorpusFnameTuple</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">FileParsedTuple</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">FileParsedTuple</span><span class="p">]]]]:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_aggregate_corpus_data</span><span class="p">(</span><span class="s1">&#39;get_all_parsed&#39;</span><span class="p">,</span>
                                           <span class="n">facets</span><span class="o">=</span><span class="n">facets</span><span class="p">,</span>
                                           <span class="n">view_name</span><span class="o">=</span><span class="n">view_name</span><span class="p">,</span>
                                           <span class="n">force</span><span class="o">=</span><span class="n">force</span><span class="p">,</span>
                                           <span class="n">choose</span><span class="o">=</span><span class="n">choose</span><span class="p">,</span>
                                           <span class="n">flat</span><span class="o">=</span><span class="n">flat</span><span class="p">,</span>
                                           <span class="n">include_empty</span><span class="o">=</span><span class="n">include_empty</span><span class="p">,</span>
                                           <span class="n">concatenate</span><span class="o">=</span><span class="n">concatenate</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_corpus</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Corpus</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">corpus_objects</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Don&#39;t have a corpus called &#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39;, only </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">corpus_objects</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">corpus_objects</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>


<div class="viewcode-block" id="Parse.get_dataframes"><a class="viewcode-back" href="../../reference.html#ms3.parse.Parse.get_dataframes">[docs]</a>    <span class="k">def</span> <span class="nf">get_dataframes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                       <span class="n">notes</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                       <span class="n">rests</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                       <span class="n">notes_and_rests</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                       <span class="n">measures</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                       <span class="n">events</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                       <span class="n">labels</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                       <span class="n">chords</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                       <span class="n">expanded</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                       <span class="n">form_labels</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                       <span class="n">cadences</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                       <span class="n">view_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                       <span class="n">force</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                       <span class="n">choose</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="s1">&#39;ask&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;all&#39;</span><span class="p">,</span>
                       <span class="n">unfold</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                       <span class="n">interval_index</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                       <span class="n">flat</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                       <span class="n">include_empty</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                      <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="n">CorpusFnameTuple</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span>  <span class="n">List</span><span class="p">[</span><span class="n">FileDataframeTuple</span><span class="p">]],</span> <span class="n">List</span><span class="p">[</span><span class="n">FileDataframeTuple</span><span class="p">]]]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Renamed to :meth:`get_facets`.&quot;&quot;&quot;</span>
        <span class="n">l</span> <span class="o">=</span> <span class="nb">locals</span><span class="p">()</span>
        <span class="n">facets</span> <span class="o">=</span> <span class="p">[</span><span class="n">facet</span> <span class="k">for</span> <span class="n">facet</span> <span class="ow">in</span> <span class="n">ScoreFacet</span><span class="o">.</span><span class="n">__args__</span> <span class="k">if</span> <span class="n">l</span><span class="p">[</span><span class="n">facet</span><span class="p">]]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_facets</span><span class="p">(</span><span class="n">facets</span><span class="o">=</span><span class="n">facets</span><span class="p">,</span>
                               <span class="n">view_name</span><span class="o">=</span><span class="n">view_name</span><span class="p">,</span>
                               <span class="n">force</span><span class="o">=</span><span class="n">force</span><span class="p">,</span>
                               <span class="n">choose</span><span class="o">=</span><span class="n">choose</span><span class="p">,</span>
                               <span class="n">unfold</span><span class="o">=</span><span class="n">unfold</span><span class="p">,</span>
                               <span class="n">interval_index</span><span class="o">=</span><span class="n">interval_index</span><span class="p">,</span>
                               <span class="n">flat</span><span class="o">=</span><span class="n">flat</span><span class="p">,</span>
                               <span class="n">include_empty</span><span class="o">=</span><span class="n">include_empty</span><span class="p">)</span></div>

<div class="viewcode-block" id="Parse.get_facet"><a class="viewcode-back" href="../../reference.html#ms3.parse.Parse.get_facet">[docs]</a>    <span class="k">def</span> <span class="nf">get_facet</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                   <span class="n">facet</span><span class="p">:</span> <span class="n">ScoreFacet</span><span class="p">,</span>
                   <span class="n">view_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                   <span class="n">choose</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="s1">&#39;ask&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;auto&#39;</span><span class="p">,</span>
                   <span class="n">unfold</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                   <span class="n">interval_index</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                   <span class="n">concatenate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                   <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">FileDataframeTuple</span><span class="p">],</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieves exactly one DataFrame per piece, if available.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_aggregate_corpus_data</span><span class="p">(</span><span class="s1">&#39;get_facet&#39;</span><span class="p">,</span>
                                           <span class="n">facet</span><span class="o">=</span><span class="n">facet</span><span class="p">,</span>
                                           <span class="n">view_name</span><span class="o">=</span><span class="n">view_name</span><span class="p">,</span>
                                           <span class="n">choose</span><span class="o">=</span><span class="n">choose</span><span class="p">,</span>
                                           <span class="n">unfold</span><span class="o">=</span><span class="n">unfold</span><span class="p">,</span>
                                           <span class="n">interval_index</span><span class="o">=</span><span class="n">interval_index</span><span class="p">,</span>
                                           <span class="n">concatenate</span><span class="o">=</span><span class="n">concatenate</span><span class="p">,</span>
                                           <span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">get_facets</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                   <span class="n">facets</span><span class="p">:</span> <span class="n">ScoreFacets</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                   <span class="n">view_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                   <span class="n">force</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                   <span class="n">choose</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="s1">&#39;ask&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;all&#39;</span><span class="p">,</span>
                   <span class="n">unfold</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                   <span class="n">interval_index</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                   <span class="n">flat</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                   <span class="n">include_empty</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                   <span class="n">concatenate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                   <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="n">CorpusFnameTuple</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span>  <span class="n">List</span><span class="p">[</span><span class="n">FileDataframeTuple</span><span class="p">]],</span> <span class="n">List</span><span class="p">[</span><span class="n">FileDataframeTuple</span><span class="p">]]]]:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_aggregate_corpus_data</span><span class="p">(</span><span class="s1">&#39;get_facets&#39;</span><span class="p">,</span>
                                           <span class="n">facets</span><span class="o">=</span><span class="n">facets</span><span class="p">,</span>
                                           <span class="n">view_name</span><span class="o">=</span><span class="n">view_name</span><span class="p">,</span>
                                           <span class="n">force</span><span class="o">=</span><span class="n">force</span><span class="p">,</span>
                                           <span class="n">choose</span><span class="o">=</span><span class="n">choose</span><span class="p">,</span>
                                           <span class="n">unfold</span><span class="o">=</span><span class="n">unfold</span><span class="p">,</span>
                                           <span class="n">interval_index</span><span class="o">=</span><span class="n">interval_index</span><span class="p">,</span>
                                           <span class="n">flat</span><span class="o">=</span><span class="n">flat</span><span class="p">,</span>
                                           <span class="n">include_empty</span><span class="o">=</span><span class="n">include_empty</span><span class="p">,</span>
                                           <span class="n">concatenate</span><span class="o">=</span><span class="n">concatenate</span><span class="p">,</span>
                                           <span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_files</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">facets</span><span class="p">:</span> <span class="n">FacetArguments</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                  <span class="n">view_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                  <span class="n">parsed</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                  <span class="n">unparsed</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                  <span class="n">choose</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="s1">&#39;ask&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;all&#39;</span><span class="p">,</span>
                  <span class="n">flat</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                  <span class="n">include_empty</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                  <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="n">CorpusFnameTuple</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="n">FileDict</span><span class="p">,</span> <span class="n">FileList</span><span class="p">]]:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_aggregate_corpus_data</span><span class="p">(</span><span class="s1">&#39;get_files&#39;</span><span class="p">,</span>
                                           <span class="n">facets</span><span class="o">=</span><span class="n">facets</span><span class="p">,</span>
                                           <span class="n">view_name</span><span class="o">=</span><span class="n">view_name</span><span class="p">,</span>
                                           <span class="n">parsed</span><span class="o">=</span><span class="n">parsed</span><span class="p">,</span>
                                           <span class="n">unparsed</span><span class="o">=</span><span class="n">unparsed</span><span class="p">,</span>
                                           <span class="n">choose</span><span class="o">=</span><span class="n">choose</span><span class="p">,</span>
                                           <span class="n">flat</span><span class="o">=</span><span class="n">flat</span><span class="p">,</span>
                                           <span class="n">include_empty</span><span class="o">=</span><span class="n">include_empty</span>
                                           <span class="p">)</span>




<div class="viewcode-block" id="Parse.get_piece"><a class="viewcode-back" href="../../reference.html#ms3.parse.Parse.get_piece">[docs]</a>    <span class="k">def</span> <span class="nf">get_piece</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">corpus_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">fname</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Piece</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns an existing Piece object.&quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="n">corpus_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">corpus_objects</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">corpus_name</span><span class="si">}</span><span class="s2">&#39; is not an existing corpus. Choose from </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">corpus_objects</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">corpus_objects</span><span class="p">[</span><span class="n">corpus_name</span><span class="p">]</span><span class="o">.</span><span class="n">get_piece</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span></div>

<div class="viewcode-block" id="Parse.get_view"><a class="viewcode-back" href="../../reference.html#ms3.parse.Parse.get_view">[docs]</a>    <span class="k">def</span> <span class="nf">get_view</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">view_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="o">**</span><span class="n">config</span>
                 <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">View</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieve an existing or create a new View object, potentially while updating the config.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">view_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_views</span><span class="p">:</span>
            <span class="n">view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_views</span><span class="p">[</span><span class="n">view_name</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">view_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_views</span><span class="p">[</span><span class="kc">None</span><span class="p">]</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">view_name</span><span class="p">:</span>
            <span class="n">view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_views</span><span class="p">[</span><span class="kc">None</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_view</span><span class="p">()</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">new_name</span><span class="o">=</span><span class="n">view_name</span><span class="p">)</span>
            <span class="n">old_name</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">name</span>
            <span class="n">view</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">view_name</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_views</span><span class="p">[</span><span class="n">view_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">view</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;New view &#39;</span><span class="si">{</span><span class="n">view_name</span><span class="si">}</span><span class="s2">&#39; created as a copy of &#39;</span><span class="si">{</span><span class="n">old_name</span><span class="si">}</span><span class="s2">&#39;.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">config</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">view</span><span class="o">.</span><span class="n">update_config</span><span class="p">(</span><span class="o">**</span><span class="n">config</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">view</span></div>


    <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">view_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">return_str</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">show_discarded</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>
        <span class="n">header</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;All corpora&quot;</span>
        <span class="n">header</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">header</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>

        <span class="c1"># start info message with the names of the available views, the header, and info on the active view.</span>
        <span class="n">view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_view</span><span class="p">(</span><span class="n">view_name</span><span class="p">)</span>
        <span class="n">view</span><span class="o">.</span><span class="n">reset_filtering_data</span><span class="p">()</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">available_views2str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_views</span><span class="p">,</span> <span class="n">view_name</span><span class="p">)</span>
        <span class="n">msg</span> <span class="o">+=</span> <span class="n">header</span>
        <span class="n">view_info</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;View: </span><span class="si">{</span><span class="n">view</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="n">view_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">corpus_views</span> <span class="o">=</span> <span class="p">[</span><span class="n">corpus</span><span class="o">.</span><span class="n">get_view</span><span class="p">()</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">corpus</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter_corpora</span><span class="p">(</span><span class="n">view_name</span><span class="o">=</span><span class="n">view_name</span><span class="p">)]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">corpus_views</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">view_info</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;This is a mixed view. Call _.info(view_name) to see a homogeneous one.&quot;</span>
        <span class="n">msg</span> <span class="o">+=</span> <span class="n">view_info</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span>

        <span class="c1"># Show info on all pieces and files included in the active view</span>
        <span class="n">counts_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">count_files</span><span class="p">(</span><span class="n">view_name</span><span class="o">=</span><span class="n">view_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">counts_df</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_detected</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">+=</span> <span class="s1">&#39;No files detected. Use _.add_corpus().&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">+=</span> <span class="s1">&#39;No files selected under the current view. You could use _.all to see everything.&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">counts_df</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">any</span><span class="p">()</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
                <span class="n">counts_df</span> <span class="o">=</span> <span class="n">counts_df</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;int&#39;</span><span class="p">)</span>
            <span class="n">additional_columns</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">corpus_name</span> <span class="ow">in</span> <span class="n">counts_df</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
                <span class="n">corpus</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_corpus</span><span class="p">(</span><span class="n">corpus_name</span><span class="p">)</span>
                <span class="n">has_metadata</span> <span class="o">=</span> <span class="s1">&#39;no&#39;</span> <span class="k">if</span> <span class="n">corpus</span><span class="o">.</span><span class="n">metadata_tsv</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="s1">&#39;yes&#39;</span>
                <span class="n">corpus_view</span> <span class="o">=</span> <span class="n">corpus</span><span class="o">.</span><span class="n">get_view</span><span class="p">()</span><span class="o">.</span><span class="n">name</span>
                <span class="n">additional_columns</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">has_metadata</span><span class="p">,</span> <span class="n">corpus_view</span><span class="p">])</span>
            <span class="n">additional_columns</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">additional_columns</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;has&#39;</span><span class="p">,</span> <span class="s1">&#39;metadata&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;active&#39;</span><span class="p">,</span> <span class="s1">&#39;view&#39;</span><span class="p">)],</span> <span class="n">index</span><span class="o">=</span><span class="n">counts_df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
            <span class="n">info_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">additional_columns</span><span class="p">,</span> <span class="n">counts_df</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">info_df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_tuples</span><span class="p">(</span><span class="n">info_df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="n">info_df</span><span class="o">.</span><span class="n">to_string</span><span class="p">()</span>
            <span class="n">n_changed_scores</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">count_changed_scores</span><span class="p">(</span><span class="n">view_name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">n_changed_scores</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="si">{</span><span class="n">n_changed_scores</span><span class="si">}</span><span class="s2"> scores have changed since parsing.&quot;</span>
            <span class="n">filtering_report</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">filtering_report</span><span class="p">(</span><span class="n">show_discarded</span><span class="o">=</span><span class="n">show_discarded</span><span class="p">,</span> <span class="n">return_str</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">filtering_report</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">filtering_report</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_orphans</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">There are </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">n_orphans</span><span class="si">}</span><span class="s2"> orphans that could not be attributed to any of the respective corpus&#39;s fnames&quot;</span>
            <span class="k">if</span> <span class="n">show_discarded</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">+=</span> <span class="s1">&#39;:&#39;</span>
                <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">corpus</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">corpus</span><span class="o">.</span><span class="n">n_orphans</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">msg</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n\t</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">corpus</span><span class="o">.</span><span class="n">ix2orphan_file</span><span class="o">.</span><span class="n">values</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;.&quot;</span>
        <span class="k">if</span> <span class="n">return_str</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">msg</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>


<div class="viewcode-block" id="Parse.insert_detached_labels"><a class="viewcode-back" href="../../reference.html#ms3.parse.Parse.insert_detached_labels">[docs]</a>    <span class="k">def</span> <span class="nf">insert_detached_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                               <span class="n">view_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                               <span class="n">key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;detached&#39;</span><span class="p">,</span>
                               <span class="n">staff</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                               <span class="n">voice</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                               <span class="n">harmony_layer</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                               <span class="n">check_for_clashes</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Attach all :py:attr:`~.annotations.Annotations` objects that are reachable via ``Score.key`` to their</span>
<span class="sd">        respective :py:attr:`~.score.Score`, altering the XML in memory. Calling :py:meth:`.store_scores` will output</span>
<span class="sd">        MuseScore files where the annotations show in the score.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        key :</span>
<span class="sd">            Key under which the :py:attr:`~.annotations.Annotations` objects to be attached are stored in the</span>
<span class="sd">            :py:attr:`~.score.Score` objects. Defaults to &#39;detached&#39;.</span>
<span class="sd">        staff : :obj:`int`, optional</span>
<span class="sd">            If you pass a staff ID, the labels will be attached to that staff where 1 is the upper stuff.</span>
<span class="sd">            By default, the staves indicated in the &#39;staff&#39; column of :obj:`ms3.annotations.Annotations.df`</span>
<span class="sd">            will be used.</span>
<span class="sd">        voice : {1, 2, 3, 4}, optional</span>
<span class="sd">            If you pass the ID of a notational layer (where 1 is the upper voice, blue in MuseScore),</span>
<span class="sd">            the labels will be attached to that one.</span>
<span class="sd">            By default, the notational layers indicated in the &#39;voice&#39; column of</span>
<span class="sd">            :obj:`ms3.annotations.Annotations.df` will be used.</span>
<span class="sd">        harmony_layer : :obj:`int`, optional</span>
<span class="sd">            | By default, the labels are written to the layer specified as an integer in the column ``harmony_layer``.</span>
<span class="sd">            | Pass an integer to select a particular layer:</span>
<span class="sd">            | * 0 to attach them as absolute (&#39;guitar&#39;) chords, meaning that when opened next time,</span>
<span class="sd">            |   MuseScore will split and encode those beginning with a note name ( resulting in ms3-internal harmony_layer 3).</span>
<span class="sd">            | * 1 the labels are written into the staff&#39;s layer for Roman Numeral Analysis.</span>
<span class="sd">            | * 2 to have MuseScore interpret them as Nashville Numbers</span>
<span class="sd">        check_for_clashes : :obj:`bool`, optional</span>
<span class="sd">            By default, warnings are thrown when there already exists a label at a position (and in a notational</span>
<span class="sd">            layer) where a new one is attached. Pass False to deactivate these warnings.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">reached</span><span class="p">,</span> <span class="n">goal</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">corpus</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iter_corpora</span><span class="p">(</span><span class="n">view_name</span><span class="p">),</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">r</span><span class="p">,</span> <span class="n">g</span> <span class="o">=</span> <span class="n">corpus</span><span class="o">.</span><span class="n">insert_detached_labels</span><span class="p">(</span><span class="n">view_name</span><span class="o">=</span><span class="n">view_name</span><span class="p">,</span>
                                          <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span>
                                          <span class="n">staff</span><span class="o">=</span><span class="n">staff</span><span class="p">,</span>
                                          <span class="n">voice</span><span class="o">=</span><span class="n">voice</span><span class="p">,</span>
                                          <span class="n">harmony_layer</span><span class="o">=</span><span class="n">harmony_layer</span><span class="p">,</span>
                                          <span class="n">check_for_clashes</span><span class="o">=</span><span class="n">check_for_clashes</span>
                                          <span class="p">)</span>
            <span class="n">reached</span> <span class="o">+=</span> <span class="n">r</span>
            <span class="n">goal</span> <span class="o">+=</span> <span class="n">g</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">reached</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">goal</span><span class="si">}</span><span class="s2"> labels successfully added.&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Parse.iter_corpora"><a class="viewcode-back" href="../../reference.html#ms3.parse.Parse.iter_corpora">[docs]</a>    <span class="k">def</span> <span class="nf">iter_corpora</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">view_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Corpus</span><span class="p">],</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Iterate through corpora under the current or specified view.&quot;&quot;&quot;</span>
        <span class="n">view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_view</span><span class="p">(</span><span class="n">view_name</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">corpus_name</span><span class="p">,</span> <span class="n">corpus</span> <span class="ow">in</span> <span class="n">view</span><span class="o">.</span><span class="n">filter_by_token</span><span class="p">(</span><span class="s1">&#39;corpora&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">view_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">corpus</span><span class="o">.</span><span class="n">_views</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">view_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">corpus</span><span class="o">.</span><span class="n">set_view</span><span class="p">(</span><span class="n">view</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">corpus</span><span class="o">.</span><span class="n">set_view</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="n">view_name</span><span class="p">:</span> <span class="n">view</span><span class="p">})</span>
            <span class="k">yield</span> <span class="n">corpus_name</span><span class="p">,</span> <span class="n">corpus</span></div>

    <span class="k">def</span> <span class="nf">iter_pieces</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">CorpusFnameTuple</span><span class="p">,</span> <span class="n">Piece</span><span class="p">]:</span>
        <span class="k">for</span> <span class="n">corpus_name</span><span class="p">,</span> <span class="n">corpus</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">fname</span><span class="p">,</span> <span class="n">piece</span> <span class="ow">in</span> <span class="n">corpus</span><span class="p">:</span>
                <span class="k">yield</span> <span class="p">(</span><span class="n">corpus_name</span><span class="p">,</span> <span class="n">fname</span><span class="p">),</span> <span class="n">piece</span>

<div class="viewcode-block" id="Parse.keys"><a class="viewcode-back" href="../../reference.html#ms3.parse.Parse.keys">[docs]</a>    <span class="k">def</span> <span class="nf">keys</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the names of all corpus objects.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">corpus_objects</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span></div>

    <span class="k">def</span> <span class="nf">load_facet_into_scores</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                               <span class="n">facet</span><span class="p">:</span> <span class="n">AnnotationsFacet</span><span class="p">,</span>
                               <span class="n">view_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                               <span class="n">force</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                               <span class="n">choose</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="s1">&#39;ask&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;auto&#39;</span><span class="p">,</span>
                               <span class="n">git_revision</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                               <span class="n">key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;detached&#39;</span><span class="p">,</span>
                               <span class="n">infer</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                               <span class="o">**</span><span class="n">cols</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">corpus_name</span><span class="p">,</span> <span class="n">corpus</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter_corpora</span><span class="p">(</span><span class="n">view_name</span><span class="p">):</span>
            <span class="n">result</span><span class="p">[</span><span class="n">corpus_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">corpus</span><span class="o">.</span><span class="n">load_facet_into_scores</span><span class="p">(</span><span class="n">facet</span><span class="o">=</span><span class="n">facet</span><span class="p">,</span>
                                                                <span class="n">view_name</span><span class="o">=</span><span class="n">view_name</span><span class="p">,</span>
                                                                <span class="n">force</span><span class="o">=</span><span class="n">force</span><span class="p">,</span>
                                                                <span class="n">choose</span><span class="o">=</span><span class="n">choose</span><span class="p">,</span>
                                                                <span class="n">git_revision</span><span class="o">=</span><span class="n">git_revision</span><span class="p">,</span>
                                                                <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span>
                                                                <span class="n">infer</span><span class="o">=</span><span class="n">infer</span><span class="p">,</span>
                                                                <span class="o">**</span><span class="n">cols</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>

<div class="viewcode-block" id="Parse.load_ignored_warnings"><a class="viewcode-back" href="../../reference.html#ms3.parse.Parse.load_ignored_warnings">[docs]</a>    <span class="k">def</span> <span class="nf">load_ignored_warnings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Adds a filters to all loggers included in a IGNORED_WARNINGS file.</span>

<span class="sd">        Args:</span>
<span class="sd">            path: Path of the IGNORED_WARNINGS file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">corpus</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">_</span> <span class="o">=</span> <span class="n">corpus</span><span class="o">.</span><span class="n">load_ignored_warnings</span><span class="p">(</span><span class="n">path</span><span class="p">)</span></div>

<div class="viewcode-block" id="Parse.set_view"><a class="viewcode-back" href="../../reference.html#ms3.parse.Parse.set_view">[docs]</a>    <span class="k">def</span> <span class="nf">set_view</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">active</span><span class="p">:</span> <span class="n">View</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">views</span><span class="p">:</span> <span class="n">View</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Register one or several view_name=View pairs.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">active</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">new_name</span> <span class="o">=</span> <span class="n">active</span><span class="o">.</span><span class="n">name</span>
            <span class="k">if</span> <span class="n">new_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_views</span> <span class="ow">and</span> <span class="n">active</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_views</span><span class="p">[</span><span class="n">new_name</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The existing view called &#39;</span><span class="si">{</span><span class="n">new_name</span><span class="si">}</span><span class="s2">&#39; has been overwritten&quot;</span><span class="p">)</span>
                <span class="k">del</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_views</span><span class="p">[</span><span class="n">new_name</span><span class="p">])</span>
            <span class="n">old_view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_views</span><span class="p">[</span><span class="kc">None</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_views</span><span class="p">[</span><span class="n">old_view</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">old_view</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_views</span><span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="n">active</span>
        <span class="k">for</span> <span class="n">view_name</span><span class="p">,</span> <span class="n">view</span> <span class="ow">in</span> <span class="n">views</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">view</span><span class="o">.</span><span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">view</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">view_name</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_views</span><span class="p">[</span><span class="n">view_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">view</span>
        <span class="k">for</span> <span class="n">corpus_name</span><span class="p">,</span> <span class="n">corpus</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">active</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">active</span><span class="o">.</span><span class="n">check_token</span><span class="p">(</span><span class="s1">&#39;corpus&#39;</span><span class="p">,</span> <span class="n">corpus_name</span><span class="p">):</span>
                <span class="n">corpus</span><span class="o">.</span><span class="n">set_view</span><span class="p">(</span><span class="n">active</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">view_name</span><span class="p">,</span> <span class="n">view</span> <span class="ow">in</span> <span class="n">views</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">view</span><span class="o">.</span><span class="n">check_token</span><span class="p">(</span><span class="s1">&#39;corpus&#39;</span><span class="p">,</span> <span class="n">corpus_name</span><span class="p">):</span>
                    <span class="n">corpus</span><span class="o">.</span><span class="n">set_view</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="n">view_name</span><span class="p">:</span> <span class="n">view</span><span class="p">})</span></div>

    <span class="k">def</span> <span class="nf">switch_view</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">view_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                    <span class="n">show_info</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                    <span class="n">propagate</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">view_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">new_view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_view</span><span class="p">(</span><span class="n">view_name</span><span class="p">)</span>
        <span class="n">old_view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_view</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_views</span><span class="p">[</span><span class="n">old_view</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">old_view</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_views</span><span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_view</span>
        <span class="n">new_name</span> <span class="o">=</span> <span class="n">new_view</span><span class="o">.</span><span class="n">name</span>
        <span class="k">if</span> <span class="n">new_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_views</span><span class="p">:</span>
            <span class="k">del</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_views</span><span class="p">[</span><span class="n">new_name</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">propagate</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">corpus_name</span><span class="p">,</span> <span class="n">corpus</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
                <span class="n">active_view</span> <span class="o">=</span> <span class="n">corpus</span><span class="o">.</span><span class="n">get_view</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">active_view</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="n">new_name</span> <span class="ow">or</span> <span class="n">active_view</span> <span class="o">!=</span> <span class="n">new_view</span><span class="p">:</span>
                    <span class="n">corpus</span><span class="o">.</span><span class="n">set_view</span><span class="p">(</span><span class="n">new_view</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">show_info</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>

<div class="viewcode-block" id="Parse.update_metadata_tsv_from_parsed_scores"><a class="viewcode-back" href="../../reference.html#ms3.parse.Parse.update_metadata_tsv_from_parsed_scores">[docs]</a>    <span class="k">def</span> <span class="nf">update_metadata_tsv_from_parsed_scores</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                               <span class="n">root_dir</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                                               <span class="n">suffix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                                               <span class="n">markdown_file</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;README.md&quot;</span><span class="p">,</span>
                                               <span class="n">view_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                                               <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gathers the metadata from parsed and currently selected scores and updates &#39;metadata.tsv&#39; with the information.</span>

<span class="sd">        Args:</span>
<span class="sd">            root_dir: In case you want to output the metadata to folder different from :attr:`corpus_path`.</span>
<span class="sd">            suffix:</span>
<span class="sd">                Added to the filename: &#39;metadata{suffix}.tsv&#39;. Defaults to &#39;&#39;. Metadata files with suffix may be</span>
<span class="sd">                used to store views with particular subselections of pieces.</span>
<span class="sd">            markdown_file:</span>
<span class="sd">                By default, a subset of metadata columns will be written to &#39;README.md&#39; in the same folder as the TSV file.</span>
<span class="sd">                If the file exists, it will be scanned for a line containing the string &#39;# Overview&#39; and overwritten</span>
<span class="sd">                from that line onwards.</span>
<span class="sd">            view_name:</span>
<span class="sd">                The view under which you want to update metadata from the selected parsed files. Defaults to None,</span>
<span class="sd">                i.e. the active view.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The file paths to which metadata was written.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">metadata_paths</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">corpus</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter_corpora</span><span class="p">():</span>
            <span class="n">paths</span> <span class="o">=</span> <span class="n">corpus</span><span class="o">.</span><span class="n">update_metadata_tsv_from_parsed_scores</span><span class="p">(</span><span class="n">root_dir</span><span class="o">=</span><span class="n">root_dir</span><span class="p">,</span>
                                                                  <span class="n">suffix</span><span class="o">=</span><span class="n">suffix</span><span class="p">,</span>
                                                                  <span class="n">markdown_file</span><span class="o">=</span><span class="n">markdown_file</span><span class="p">,</span>
                                                                  <span class="n">view_name</span><span class="o">=</span><span class="n">view_name</span><span class="p">)</span>
            <span class="n">metadata_paths</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">paths</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">metadata_paths</span></div>

<div class="viewcode-block" id="Parse.update_score_metadata_from_tsv"><a class="viewcode-back" href="../../reference.html#ms3.parse.Parse.update_score_metadata_from_tsv">[docs]</a>    <span class="k">def</span> <span class="nf">update_score_metadata_from_tsv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                       <span class="n">view_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                                       <span class="n">force</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                                       <span class="n">choose</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="s1">&#39;ask&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;all&#39;</span><span class="p">,</span>
                                       <span class="n">write_empty_values</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                                       <span class="n">remove_unused_fields</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                                       <span class="n">write_text_fields</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
                                       <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">File</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Update metadata fields of parsed scores with the values from the corresponding row in metadata.tsv.</span>

<span class="sd">        Args:</span>
<span class="sd">            view_name:</span>
<span class="sd">            force:</span>
<span class="sd">            choose:</span>
<span class="sd">            write_empty_values:</span>
<span class="sd">                If set to True, existing values are overwritten even if the new value is empty, in which case the field</span>
<span class="sd">                will be set to &#39;&#39;.</span>
<span class="sd">            remove_unused_fields:</span>
<span class="sd">                If set to True, all non-default fields that are not among the columns of metadata.tsv (anymore) are removed.</span>
<span class="sd">            write_text_fields:</span>
<span class="sd">                If set to True, ms3 will write updated values from the columns ``title_text``, ``subtitle_text``, ``composer_text``,</span>
<span class="sd">                ``lyricist_text``, and ``part_name_text`` into the score headers.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of File objects of those scores of which the XML structure has been modified.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">updated_scores</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">corpus</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter_corpora</span><span class="p">(</span><span class="n">view_name</span><span class="p">):</span>
            <span class="n">modified</span> <span class="o">=</span> <span class="n">corpus</span><span class="o">.</span><span class="n">update_score_metadata_from_tsv</span><span class="p">(</span><span class="n">view_name</span><span class="o">=</span><span class="n">view_name</span><span class="p">,</span>
                                                             <span class="n">force</span><span class="o">=</span><span class="n">force</span><span class="p">,</span>
                                                             <span class="n">choose</span><span class="o">=</span><span class="n">choose</span><span class="p">,</span>
                                                             <span class="n">write_empty_values</span><span class="o">=</span><span class="n">write_empty_values</span><span class="p">,</span>
                                                             <span class="n">remove_unused_fields</span><span class="o">=</span><span class="n">remove_unused_fields</span><span class="p">,</span>
                                                             <span class="n">write_text_fields</span><span class="o">=</span><span class="n">write_text_fields</span><span class="p">)</span>
            <span class="n">updated_scores</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">modified</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">updated_scores</span></div>

<div class="viewcode-block" id="Parse.update_scores"><a class="viewcode-back" href="../../reference.html#ms3.parse.Parse.update_scores">[docs]</a>    <span class="k">def</span> <span class="nf">update_scores</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                      <span class="n">root_dir</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                      <span class="n">folder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span>
                      <span class="n">suffix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                      <span class="n">overwrite</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Update scores created with an older MuseScore version to the latest MuseScore 3 version.</span>

<span class="sd">                Args:</span>
<span class="sd">                    root_dir:</span>
<span class="sd">                        In case you want to create output paths for the updated MuseScore files based on a folder different</span>
<span class="sd">                        from :attr:`corpus_path`.</span>
<span class="sd">                    folder:</span>
<span class="sd">                        * The default &#39;.&#39; has the updated scores written to the same directory as the old ones, effectively</span>
<span class="sd">                          overwriting them if ``root_dir`` is None.</span>
<span class="sd">                        * If ``folder`` is None, the files will be written to ``{root_dir}/scores/``.</span>
<span class="sd">                        * If ``folder`` is an absolute path, ``root_dir`` will be ignored.</span>
<span class="sd">                        * If ``folder`` is a relative path starting with a dot ``.`` the relative path is appended to the file&#39;s subdir.</span>
<span class="sd">                          For example, ``..\scores`` will resolve to a sibling directory of the one where the ``file`` is located.</span>
<span class="sd">                        * If ``folder`` is a relative path that does not begin with a dot ``.``, it will be appended to the</span>
<span class="sd">                          ``root_dir``.</span>
<span class="sd">                    suffix: String to append to the file names of the updated files, e.g. &#39;_updated&#39;.</span>
<span class="sd">                    overwrite: By default, existing files are not overwritten. Pass True to allow this.</span>

<span class="sd">                Returns:</span>
<span class="sd">                    A list of all up-to-date paths, whether they had to be converted or were already in the latest version.</span>
<span class="sd">                &quot;&quot;&quot;</span>
        <span class="n">up2date_paths</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">corpus</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter_corpora</span><span class="p">():</span>
            <span class="n">paths</span> <span class="o">=</span> <span class="n">corpus</span><span class="o">.</span><span class="n">update_scores</span><span class="p">(</span><span class="n">root_dir</span><span class="o">=</span><span class="n">root_dir</span><span class="p">,</span>
                                         <span class="n">folder</span><span class="o">=</span><span class="n">folder</span><span class="p">,</span>
                                         <span class="n">suffix</span><span class="o">=</span><span class="n">suffix</span><span class="p">,</span>
                                         <span class="n">overwrite</span><span class="o">=</span><span class="n">overwrite</span><span class="p">)</span>
            <span class="n">up2date_paths</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">paths</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">up2date_paths</span></div>


<div class="viewcode-block" id="Parse.update_tsvs_on_disk"><a class="viewcode-back" href="../../reference.html#ms3.parse.Parse.update_tsvs_on_disk">[docs]</a>    <span class="k">def</span> <span class="nf">update_tsvs_on_disk</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                       <span class="n">facets</span><span class="p">:</span> <span class="n">ScoreFacets</span> <span class="o">=</span> <span class="s1">&#39;tsv&#39;</span><span class="p">,</span>
                       <span class="n">view_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                       <span class="n">force</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                       <span class="n">choose</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="s1">&#39;ask&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;auto&#39;</span><span class="p">,</span>
                       <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update existing TSV files corresponding to one or several facets with information freshly extracted from a parsed</span>
<span class="sd">        score, but only if the contents are identical. Otherwise, the existing TSV file is not overwritten and the</span>
<span class="sd">        differences are displayed in a log warning. The purpose is to safely update the format of existing TSV files,</span>
<span class="sd">        (for instance with respect to column order) making sure that the content doesn&#39;t change.</span>

<span class="sd">        Args:</span>
<span class="sd">            facets:</span>
<span class="sd">            view_name:</span>
<span class="sd">            force:</span>
<span class="sd">                By default, only TSV files that have already been parsed are updated. Set to True in order to</span>
<span class="sd">                force-parse for each facet one of the TSV files included in the given view, if necessary.</span>
<span class="sd">            choose:</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of paths that have been overwritten.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">paths</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">corpus</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter_corpora</span><span class="p">(</span><span class="n">view_name</span><span class="o">=</span><span class="n">view_name</span><span class="p">):</span>
            <span class="n">paths</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">corpus</span><span class="o">.</span><span class="n">update_tsvs_on_disk</span><span class="p">(</span><span class="n">facets</span><span class="o">=</span><span class="n">facets</span><span class="p">,</span>
                                                   <span class="n">view_name</span><span class="o">=</span><span class="n">view_name</span><span class="p">,</span>
                                                   <span class="n">force</span><span class="o">=</span><span class="n">force</span><span class="p">,</span>
                                                   <span class="n">choose</span><span class="o">=</span><span class="n">choose</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">paths</span></div>

    <span class="k">def</span> <span class="nf">_aggregate_corpus_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                               <span class="n">method</span><span class="p">,</span>
                               <span class="n">view_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                               <span class="n">concatenate</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                               <span class="o">**</span><span class="n">kwargs</span>
                               <span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">corpus_name</span><span class="p">,</span> <span class="n">corpus</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter_corpora</span><span class="p">(</span><span class="n">view_name</span><span class="p">):</span>
            <span class="n">corpus_method</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">corpus</span><span class="p">,</span> <span class="n">method</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;get_facet&#39;</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;concatenate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">corpus_result</span> <span class="o">=</span> <span class="n">corpus_method</span><span class="p">(</span><span class="n">view_name</span><span class="o">=</span><span class="n">view_name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">fname</span><span class="p">,</span> <span class="n">piece_result</span> <span class="ow">in</span> <span class="n">corpus_result</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;get_facet&#39;</span><span class="p">:</span>
                    <span class="n">piece_result</span> <span class="o">=</span> <span class="p">[</span><span class="n">piece_result</span><span class="p">]</span>
                <span class="n">result</span><span class="p">[(</span><span class="n">corpus_name</span><span class="p">,</span> <span class="n">fname</span><span class="p">)]</span> <span class="o">=</span> <span class="n">piece_result</span>
        <span class="k">if</span> <span class="n">concatenate</span><span class="p">:</span>
            <span class="n">keys</span><span class="p">,</span> <span class="n">dataframes</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
            <span class="n">flat</span> <span class="o">=</span> <span class="s1">&#39;flat&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">or</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;flat&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">flat</span><span class="p">:</span>
                <span class="n">add_index_level</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">piece_result</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">piece_result</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">add_index_level</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">file_dataframe_tuples</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">piece_result</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">for</span> <span class="n">file_dataframe_tuples</span> <span class="ow">in</span> <span class="n">piece_result</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
            <span class="k">for</span> <span class="n">corpus_fname</span><span class="p">,</span> <span class="n">piece_result</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">flat</span><span class="p">:</span>
                    <span class="n">n_tuples</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">piece_result</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">n_tuples</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="n">keys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">corpus_fname</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">n_tuples</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">add_index_level</span><span class="p">:</span>
                            <span class="n">file</span><span class="p">,</span> <span class="n">df</span> <span class="o">=</span> <span class="n">piece_result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df</span><span class="p">],</span> <span class="n">keys</span><span class="o">=</span><span class="p">[</span><span class="n">file</span><span class="o">.</span><span class="n">rel_path</span><span class="p">])</span>
                            <span class="n">dataframes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">dataframes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">piece_result</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">files</span><span class="p">,</span> <span class="n">dfs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">piece_result</span><span class="p">))</span>
                        <span class="n">ix_level</span> <span class="o">=</span> <span class="p">[</span><span class="n">file</span><span class="o">.</span><span class="n">rel_path</span> <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">]</span>
                        <span class="n">concat</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">dfs</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="n">ix_level</span><span class="p">)</span>
                        <span class="n">dataframes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">concat</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">facet</span><span class="p">,</span> <span class="n">file_dataframe_tuples</span> <span class="ow">in</span> <span class="n">piece_result</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                        <span class="n">n_tuples</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">file_dataframe_tuples</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">n_tuples</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="k">continue</span>
                        <span class="n">keys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">corpus_fname</span> <span class="o">+</span> <span class="p">(</span><span class="n">facet</span><span class="p">,))</span>
                        <span class="k">if</span> <span class="n">n_tuples</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">add_index_level</span><span class="p">:</span>
                                <span class="n">file</span><span class="p">,</span> <span class="n">df</span> <span class="o">=</span> <span class="n">file_dataframe_tuples</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                                <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df</span><span class="p">],</span> <span class="n">keys</span><span class="o">=</span><span class="p">[</span><span class="n">file</span><span class="o">.</span><span class="n">rel_path</span><span class="p">])</span>
                                <span class="n">dataframes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">dataframes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file_dataframe_tuples</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">files</span><span class="p">,</span> <span class="n">dfs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">file_dataframe_tuples</span><span class="p">))</span>
                            <span class="n">ix_level</span> <span class="o">=</span> <span class="p">[</span><span class="n">file</span><span class="o">.</span><span class="n">rel_path</span> <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">]</span>
                            <span class="n">concat</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">dfs</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="n">ix_level</span><span class="p">)</span>
                            <span class="n">dataframes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">concat</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dataframes</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">dataframes</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="n">keys</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="n">n_levels</span> <span class="o">=</span> <span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">nlevels</span> <span class="k">for</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">dataframes</span><span class="p">]</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">n_levels</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="c1"># this error might come from various form label dataframes with varying numbers of column levels</span>
                        <span class="n">adapted_dataframes</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="k">for</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">dataframes</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">nlevels</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                                <span class="n">adapted_dataframes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">loc</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">get_loc</span><span class="p">(</span><span class="s1">&#39;form_label&#39;</span><span class="p">)</span>
                                <span class="n">adapted_dataframes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="p">:</span><span class="n">loc</span><span class="p">],</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="n">loc</span><span class="p">:]],</span> <span class="n">keys</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
                        <span class="n">result</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">adapted_dataframes</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="n">keys</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span>
                <span class="n">nlevels</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">nlevels</span>
                <span class="n">level_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;corpus&#39;</span><span class="p">,</span> <span class="s1">&#39;fname&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">flat</span><span class="p">:</span>
                    <span class="n">level_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;facet&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">level_names</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">nlevels</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">level_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;ix&#39;</span><span class="p">)</span>
                <span class="n">level_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">)</span>
                <span class="n">result</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">level_names</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">result</span>



    <span class="k">def</span> <span class="nf">_get_parsed_score_files</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">view_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="n">CorpusFnameTuple</span><span class="p">,</span> <span class="n">FileList</span><span class="p">]:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">corpus_name</span><span class="p">,</span> <span class="n">corpus</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter_corpora</span><span class="p">(</span><span class="n">view_name</span><span class="o">=</span><span class="n">view_name</span><span class="p">):</span>
            <span class="n">fname2files</span> <span class="o">=</span> <span class="n">corpus</span><span class="o">.</span><span class="n">get_files</span><span class="p">(</span><span class="s1">&#39;scores&#39;</span><span class="p">,</span> <span class="n">view_name</span><span class="o">=</span><span class="n">view_name</span><span class="p">,</span> <span class="n">unparsed</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">flat</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">result</span><span class="p">[</span><span class="n">corpus_name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">fname2files</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="p">[])</span>
        <span class="k">return</span> <span class="n">result</span>


    <span class="k">def</span> <span class="nf">_get_unparsed_score_files</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">view_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="n">CorpusFnameTuple</span><span class="p">,</span> <span class="n">FileList</span><span class="p">]:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">corpus_name</span><span class="p">,</span> <span class="n">corpus</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter_corpora</span><span class="p">(</span><span class="n">view_name</span><span class="o">=</span><span class="n">view_name</span><span class="p">):</span>
            <span class="n">fname2files</span> <span class="o">=</span> <span class="n">corpus</span><span class="o">.</span><span class="n">get_files</span><span class="p">(</span><span class="s1">&#39;scores&#39;</span><span class="p">,</span> <span class="n">view_name</span><span class="o">=</span><span class="n">view_name</span><span class="p">,</span> <span class="n">parsed</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">flat</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">result</span><span class="p">[</span><span class="n">corpus_name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">fname2files</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="p">[])</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">_get_parsed_tsv_files</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">view_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">flat</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="n">CorpusFnameTuple</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="n">FileDict</span><span class="p">,</span> <span class="n">FileList</span><span class="p">]]:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">corpus_name</span><span class="p">,</span> <span class="n">corpus</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter_corpora</span><span class="p">(</span><span class="n">view_name</span><span class="o">=</span><span class="n">view_name</span><span class="p">):</span>
            <span class="n">fname2files</span> <span class="o">=</span> <span class="n">corpus</span><span class="o">.</span><span class="n">get_files</span><span class="p">(</span><span class="s1">&#39;tsv&#39;</span><span class="p">,</span> <span class="n">view_name</span><span class="o">=</span><span class="n">view_name</span><span class="p">,</span> <span class="n">unparsed</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">flat</span><span class="o">=</span><span class="n">flat</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">flat</span><span class="p">:</span>
                <span class="n">result</span><span class="p">[</span><span class="n">corpus_name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">fname2files</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="p">[])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">dd</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">fname</span><span class="p">,</span> <span class="n">typ2files</span> <span class="ow">in</span> <span class="n">fname2files</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">for</span> <span class="n">typ</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">typ2files</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                        <span class="n">dd</span><span class="p">[</span><span class="n">typ</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">files</span><span class="p">)</span>
                <span class="n">result</span><span class="p">[</span><span class="n">corpus_name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">dd</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">_get_unparsed_tsv_files</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">view_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">flat</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="n">CorpusFnameTuple</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="n">FileDict</span><span class="p">,</span> <span class="n">FileList</span><span class="p">]]:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">corpus_name</span><span class="p">,</span> <span class="n">corpus</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter_corpora</span><span class="p">(</span><span class="n">view_name</span><span class="o">=</span><span class="n">view_name</span><span class="p">):</span>
            <span class="n">fname2files</span> <span class="o">=</span> <span class="n">corpus</span><span class="o">.</span><span class="n">get_files</span><span class="p">(</span><span class="s1">&#39;tsv&#39;</span><span class="p">,</span> <span class="n">view_name</span><span class="o">=</span><span class="n">view_name</span><span class="p">,</span> <span class="n">parsed</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">flat</span><span class="o">=</span><span class="n">flat</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">flat</span><span class="p">:</span>
                <span class="n">result</span><span class="p">[</span><span class="n">corpus_name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">fname2files</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="p">[])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">dd</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">fname</span><span class="p">,</span> <span class="n">typ2files</span> <span class="ow">in</span> <span class="n">fname2files</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">for</span> <span class="n">typ</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">typ2files</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                        <span class="n">dd</span><span class="p">[</span><span class="n">typ</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">files</span><span class="p">)</span>
                <span class="n">result</span><span class="p">[</span><span class="n">corpus_name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">dd</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>


    <span class="k">def</span> <span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">view_name</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">View</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">view_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">view_names</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">view_name</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">view_name</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">switch_view</span><span class="p">(</span><span class="n">view_name</span><span class="p">,</span> <span class="n">show_info</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">view_name</span><span class="si">}</span><span class="s2">&#39; is not an existing view. Use _.get_view(&#39;</span><span class="si">{</span><span class="n">view_name</span><span class="si">}</span><span class="s2">&#39;) to create it.&quot;</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">detach_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                      <span class="n">view_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                      <span class="n">force</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                      <span class="n">choose</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="s1">&#39;ask&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;auto&#39;</span><span class="p">,</span>
                      <span class="n">key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;removed&#39;</span><span class="p">,</span>
                      <span class="n">staff</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                      <span class="n">voice</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                      <span class="n">harmony_layer</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                      <span class="n">delete</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">corpus</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter_corpora</span><span class="p">(</span><span class="n">view_name</span><span class="p">):</span>
            <span class="n">corpus</span><span class="o">.</span><span class="n">detach_labels</span><span class="p">(</span><span class="n">view_name</span><span class="o">=</span><span class="n">view_name</span><span class="p">,</span>
                                 <span class="n">force</span><span class="o">=</span><span class="n">force</span><span class="p">,</span>
                                 <span class="n">choose</span><span class="o">=</span><span class="n">choose</span><span class="p">,</span>
                                 <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span>
                                 <span class="n">staff</span><span class="o">=</span><span class="n">staff</span><span class="p">,</span>
                                 <span class="n">voice</span><span class="o">=</span><span class="n">voice</span><span class="p">,</span>
                                 <span class="n">harmony_layer</span><span class="o">=</span><span class="n">harmony_layer</span><span class="p">,</span>
                                 <span class="n">delete</span><span class="o">=</span><span class="n">delete</span><span class="p">)</span>



    <span class="k">def</span> <span class="nf">score_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">view_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="n">metadata_dfs</span> <span class="o">=</span> <span class="p">{</span><span class="n">corpus_name</span><span class="p">:</span> <span class="n">corpus</span><span class="o">.</span><span class="n">score_metadata</span><span class="p">(</span><span class="n">view_name</span><span class="o">=</span><span class="n">view_name</span><span class="p">)</span> <span class="k">for</span> <span class="n">corpus_name</span><span class="p">,</span> <span class="n">corpus</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter_corpora</span><span class="p">(</span><span class="n">view_name</span><span class="o">=</span><span class="n">view_name</span><span class="p">)}</span>
        <span class="n">metadata</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">metadata_dfs</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">keys</span><span class="o">=</span><span class="n">metadata_dfs</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;corpus&#39;</span><span class="p">,</span> <span class="s1">&#39;fname&#39;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">metadata</span>

    <span class="k">def</span> <span class="nf">metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">view_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">choose</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="s1">&#39;ask&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="n">metadata_dfs</span> <span class="o">=</span> <span class="p">{</span><span class="n">corpus_name</span><span class="p">:</span> <span class="n">corpus</span><span class="o">.</span><span class="n">metadata</span><span class="p">(</span><span class="n">view_name</span><span class="o">=</span><span class="n">view_name</span><span class="p">,</span> <span class="n">choose</span><span class="o">=</span><span class="n">choose</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">corpus_name</span><span class="p">,</span> <span class="n">corpus</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter_corpora</span><span class="p">(</span><span class="n">view_name</span><span class="o">=</span><span class="n">view_name</span><span class="p">)}</span>
        <span class="n">metadata</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">metadata_dfs</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">keys</span><span class="o">=</span><span class="n">metadata_dfs</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;corpus&#39;</span><span class="p">,</span> <span class="s1">&#39;fname&#39;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">metadata</span>

<div class="viewcode-block" id="Parse.metadata_tsv"><a class="viewcode-back" href="../../reference.html#ms3.parse.Parse.metadata_tsv">[docs]</a>    <span class="k">def</span> <span class="nf">metadata_tsv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">view_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Concatenates the &#39;metadata.tsv&#39; (as they come) files for all corpora with a [corpus, fname] MultiIndex. If</span>
<span class="sd">        you need metadata that filters out fnames according to the current view, use :meth:`metadata`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">metadata_dfs</span> <span class="o">=</span> <span class="p">{</span><span class="n">corpus_name</span><span class="p">:</span> <span class="n">enforce_fname_index_for_metadata</span><span class="p">(</span><span class="n">corpus</span><span class="o">.</span><span class="n">metadata_tsv</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">corpus_name</span><span class="p">,</span> <span class="n">corpus</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter_corpora</span><span class="p">(</span><span class="n">view_name</span><span class="o">=</span><span class="n">view_name</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">corpus</span><span class="o">.</span><span class="n">metadata_tsv</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                        <span class="p">}</span>
        <span class="n">metadata</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">metadata_dfs</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">keys</span><span class="o">=</span><span class="n">metadata_dfs</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;corpus&#39;</span><span class="p">,</span> <span class="s1">&#39;fname&#39;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">metadata</span></div>



<div class="viewcode-block" id="Parse.store_extracted_facets"><a class="viewcode-back" href="../../reference.html#ms3.parse.Parse.store_extracted_facets">[docs]</a>    <span class="k">def</span> <span class="nf">store_extracted_facets</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                               <span class="n">view_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                               <span class="n">root_dir</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                               <span class="n">measures_folder</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">measures_suffix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                               <span class="n">notes_folder</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">notes_suffix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                               <span class="n">rests_folder</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">rests_suffix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                               <span class="n">notes_and_rests_folder</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">notes_and_rests_suffix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                               <span class="n">labels_folder</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">labels_suffix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                               <span class="n">expanded_folder</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">expanded_suffix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                               <span class="n">form_labels_folder</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">form_labels_suffix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                               <span class="n">cadences_folder</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">cadences_suffix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                               <span class="n">events_folder</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">events_suffix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                               <span class="n">chords_folder</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">chords_suffix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                               <span class="n">metadata_suffix</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">markdown</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                               <span class="n">simulate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                               <span class="n">unfold</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                               <span class="n">interval_index</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                               <span class="n">silence_label_warnings</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;  Store facets extracted from parsed scores as TSV files.</span>

<span class="sd">        Args:</span>
<span class="sd">            view_name:</span>
<span class="sd">            root_dir:</span>
<span class="sd">                (&#39;measures&#39;, &#39;notes&#39;, &#39;rests&#39;, &#39;notes_and_rests&#39;, &#39;labels&#39;, &#39;expanded&#39;, &#39;form_labels&#39;, &#39;cadences&#39;, &#39;events&#39;, &#39;chords&#39;)</span>

<span class="sd">            measures_folder, notes_folder, rests_folder, notes_and_rests_folder, labels_folder, expanded_folder, form_labels_folder, cadences_folder, events_folder, chords_folder:</span>
<span class="sd">                Specify directory where to store the corresponding TSV files.</span>
<span class="sd">            measures_suffix, notes_suffix, rests_suffix, notes_and_rests_suffix, labels_suffix, expanded_suffix, form_labels_suffix, cadences_suffix, events_suffix, chords_suffix:</span>
<span class="sd">                Optionally specify suffixes appended to the TSVs&#39; file names. If ``unfold=True`` the suffixes default to ``_unfolded``.</span>
<span class="sd">            metadata_suffix:</span>
<span class="sd">                Specify a suffix to update the &#39;metadata{suffix}.tsv&#39; file for each corpus. For the main file, pass &#39;&#39;</span>
<span class="sd">            markdown:</span>
<span class="sd">                By default, when ``metadata_path`` is specified, a markdown file called ``README.md`` containing</span>
<span class="sd">                the columns [file_name, measures, labels, standard, annotators, reviewers] is created. If it exists already,</span>
<span class="sd">                this table will be appended or overwritten after the heading ``# Overview``.</span>
<span class="sd">            simulate:</span>
<span class="sd">            unfold:</span>
<span class="sd">                By default, repetitions are not unfolded. Pass True to duplicate values so that they correspond to a full</span>
<span class="sd">                playthrough, including correct positioning of first and second endings.</span>
<span class="sd">            interval_index:</span>
<span class="sd">            silence_label_warnings:</span>

<span class="sd">        Returns:</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">corpus_name</span><span class="p">,</span> <span class="n">corpus</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter_corpora</span><span class="p">(</span><span class="n">view_name</span><span class="o">=</span><span class="n">view_name</span><span class="p">):</span>
            <span class="n">corpus</span><span class="o">.</span><span class="n">store_extracted_facets</span><span class="p">(</span><span class="n">view_name</span><span class="o">=</span><span class="n">view_name</span><span class="p">,</span> <span class="n">root_dir</span><span class="o">=</span><span class="n">root_dir</span><span class="p">,</span> <span class="n">measures_folder</span><span class="o">=</span><span class="n">measures_folder</span><span class="p">,</span> <span class="n">measures_suffix</span><span class="o">=</span><span class="n">measures_suffix</span><span class="p">,</span> <span class="n">notes_folder</span><span class="o">=</span><span class="n">notes_folder</span><span class="p">,</span> <span class="n">notes_suffix</span><span class="o">=</span><span class="n">notes_suffix</span><span class="p">,</span>
                                          <span class="n">rests_folder</span><span class="o">=</span><span class="n">rests_folder</span><span class="p">,</span> <span class="n">rests_suffix</span><span class="o">=</span><span class="n">rests_suffix</span><span class="p">,</span> <span class="n">notes_and_rests_folder</span><span class="o">=</span><span class="n">notes_and_rests_folder</span><span class="p">,</span>
                                          <span class="n">notes_and_rests_suffix</span><span class="o">=</span><span class="n">notes_and_rests_suffix</span><span class="p">,</span> <span class="n">labels_folder</span><span class="o">=</span><span class="n">labels_folder</span><span class="p">,</span> <span class="n">labels_suffix</span><span class="o">=</span><span class="n">labels_suffix</span><span class="p">,</span> <span class="n">expanded_folder</span><span class="o">=</span><span class="n">expanded_folder</span><span class="p">,</span>
                                          <span class="n">expanded_suffix</span><span class="o">=</span><span class="n">expanded_suffix</span><span class="p">,</span> <span class="n">form_labels_folder</span><span class="o">=</span><span class="n">form_labels_folder</span><span class="p">,</span> <span class="n">form_labels_suffix</span><span class="o">=</span><span class="n">form_labels_suffix</span><span class="p">,</span>
                                          <span class="n">cadences_folder</span><span class="o">=</span><span class="n">cadences_folder</span><span class="p">,</span> <span class="n">cadences_suffix</span><span class="o">=</span><span class="n">cadences_suffix</span><span class="p">,</span> <span class="n">events_folder</span><span class="o">=</span><span class="n">events_folder</span><span class="p">,</span> <span class="n">events_suffix</span><span class="o">=</span><span class="n">events_suffix</span><span class="p">,</span>
                                          <span class="n">chords_folder</span><span class="o">=</span><span class="n">chords_folder</span><span class="p">,</span> <span class="n">chords_suffix</span><span class="o">=</span><span class="n">chords_suffix</span><span class="p">,</span> <span class="n">metadata_suffix</span><span class="o">=</span><span class="n">metadata_suffix</span><span class="p">,</span> <span class="n">markdown</span><span class="o">=</span><span class="n">markdown</span><span class="p">,</span> <span class="n">simulate</span><span class="o">=</span><span class="n">simulate</span><span class="p">,</span>
                                          <span class="n">unfold</span><span class="o">=</span><span class="n">unfold</span><span class="p">,</span> <span class="n">interval_index</span><span class="o">=</span><span class="n">interval_index</span><span class="p">,</span> <span class="n">silence_label_warnings</span><span class="o">=</span><span class="n">silence_label_warnings</span><span class="p">)</span></div>

<div class="viewcode-block" id="Parse.store_parsed_scores"><a class="viewcode-back" href="../../reference.html#ms3.parse.Parse.store_parsed_scores">[docs]</a>    <span class="k">def</span> <span class="nf">store_parsed_scores</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                            <span class="n">view_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                            <span class="n">only_changed</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                            <span class="n">root_dir</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                            <span class="n">folder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span>
                            <span class="n">suffix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                            <span class="n">overwrite</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                            <span class="n">simulate</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Stores all parsed scores under this view as MuseScore 3 files.</span>

<span class="sd">        Args:</span>
<span class="sd">            view_name: Name of another view if another than the current one is to be used.</span>
<span class="sd">            only_changed:</span>
<span class="sd">                By default, only scores that have been modified since parsing are written. Set to False to store</span>
<span class="sd">                all scores regardless.</span>
<span class="sd">            root_dir: Directory where to re-build the sub-directory tree of the :obj:`Corpus` in question.</span>
<span class="sd">            folder:</span>
<span class="sd">                Different behaviours are available. Note that only the third option ensures that file paths are distinct for</span>
<span class="sd">                files that have identical fnames but are located in different subdirectories of the same corpus.</span>

<span class="sd">                * If ``folder`` is None (default), the files&#39; type will be appended to the ``root_dir``.</span>
<span class="sd">                * If ``folder`` is an absolute path, ``root_dir`` will be ignored.</span>
<span class="sd">                * If ``folder`` is a relative path starting with a dot ``.`` the relative path is appended to the file&#39;s subdir.</span>
<span class="sd">                  For example, ``..\notes`` will resolve to a sibling directory of the one where the ``file`` is located.</span>
<span class="sd">                * If ``folder`` is a relative path that does not begin with a dot ``.``, it will be appended to the</span>
<span class="sd">                  ``root_dir``.</span>
<span class="sd">            suffix: Suffix to append to the original file name.</span>
<span class="sd">            overwrite: Pass True to overwrite existing files.</span>
<span class="sd">            simulate: Set to True if no files are to be written.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Paths of the stored files.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">paths</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">corpus_name</span><span class="p">,</span> <span class="n">corpus</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter_corpora</span><span class="p">(</span><span class="n">view_name</span><span class="p">):</span>
            <span class="n">paths</span><span class="p">[</span><span class="n">corpus_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">corpus</span><span class="o">.</span><span class="n">store_parsed_scores</span><span class="p">(</span><span class="n">view_name</span><span class="o">=</span><span class="n">view_name</span><span class="p">,</span>
                                                    <span class="n">only_changed</span><span class="o">=</span><span class="n">only_changed</span><span class="p">,</span>
                                                    <span class="n">root_dir</span><span class="o">=</span><span class="n">root_dir</span><span class="p">,</span>
                                                    <span class="n">folder</span><span class="o">=</span><span class="n">folder</span><span class="p">,</span>
                                                    <span class="n">suffix</span><span class="o">=</span><span class="n">suffix</span><span class="p">,</span>
                                                    <span class="n">overwrite</span><span class="o">=</span><span class="n">overwrite</span><span class="p">,</span>
                                                    <span class="n">simulate</span><span class="o">=</span><span class="n">simulate</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">paths</span></div>

<div class="viewcode-block" id="Parse.parse"><a class="viewcode-back" href="../../reference.html#ms3.parse.Parse.parse">[docs]</a>    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">view_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">parallel</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">only_new</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">labels_cfg</span><span class="o">=</span><span class="p">{},</span> <span class="n">cols</span><span class="o">=</span><span class="p">{},</span> <span class="n">infer_types</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Shorthand for executing parse_scores and parse_tsv at a time.</span>
<span class="sd">        Args:</span>
<span class="sd">            view_name:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parse_scores</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">level</span><span class="p">,</span> <span class="n">parallel</span><span class="o">=</span><span class="n">parallel</span><span class="p">,</span> <span class="n">only_new</span><span class="o">=</span><span class="n">only_new</span><span class="p">,</span> <span class="n">labels_cfg</span><span class="o">=</span><span class="n">labels_cfg</span><span class="p">,</span> <span class="n">view_name</span><span class="o">=</span><span class="n">view_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parse_tsv</span><span class="p">(</span><span class="n">view_name</span><span class="o">=</span><span class="n">view_name</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="n">level</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="n">cols</span><span class="p">,</span> <span class="n">infer_types</span><span class="o">=</span><span class="n">infer_types</span><span class="p">,</span> <span class="n">only_new</span><span class="o">=</span><span class="n">only_new</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="Parse.parse_scores"><a class="viewcode-back" href="../../reference.html#ms3.parse.Parse.parse_scores">[docs]</a>    <span class="k">def</span> <span class="nf">parse_scores</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                     <span class="n">level</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                     <span class="n">parallel</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                     <span class="n">only_new</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                     <span class="n">labels_cfg</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span>
                     <span class="n">view_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                     <span class="n">choose</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="s1">&#39;ask&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;all&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Parse MuseScore 3 files (MSCX or MSCZ) and store the resulting read-only Score objects. If they need</span>
<span class="sd">        to be writeable, e.g. for removing or adding labels, pass ``parallel=False`` which takes longer but prevents</span>
<span class="sd">        having to re-parse at a later point.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        keys : :obj:`str` or :obj:`~collections.abc.Collection`, optional</span>
<span class="sd">            For which key(s) to parse all MSCX files.</span>
<span class="sd">        ids : :obj:`~collections.abc.Collection`</span>
<span class="sd">            To parse only particular files, pass their IDs. ``keys`` and ``fexts`` are ignored in this case.</span>
<span class="sd">        level : {&#39;W&#39;, &#39;D&#39;, &#39;I&#39;, &#39;E&#39;, &#39;C&#39;, &#39;WARNING&#39;, &#39;DEBUG&#39;, &#39;INFO&#39;, &#39;ERROR&#39;, &#39;CRITICAL&#39;}, optional</span>
<span class="sd">            Pass a level name for which (and above which) you want to see log records.</span>
<span class="sd">        parallel : :obj:`bool`, optional</span>
<span class="sd">            Defaults to True, meaning that all CPU cores are used simultaneously to speed up the parsing. It implies</span>
<span class="sd">            that the resulting Score objects are in read-only mode and that you might not be able to use the computer</span>
<span class="sd">            during parsing. Pass False to parse one score after the other, which uses more memory but will allow</span>
<span class="sd">            making changes to the scores.</span>
<span class="sd">        only_new : :obj:`bool`, optional</span>
<span class="sd">            By default, score which already have been parsed, are not parsed again. Pass False to parse them, too.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">level</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">change_logger_cfg</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">level</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">corpus_name</span><span class="p">,</span> <span class="n">corpus</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter_corpora</span><span class="p">(</span><span class="n">view_name</span><span class="o">=</span><span class="n">view_name</span><span class="p">):</span>
            <span class="n">corpus</span><span class="o">.</span><span class="n">parse_scores</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">level</span><span class="p">,</span>
                                <span class="n">parallel</span><span class="o">=</span><span class="n">parallel</span><span class="p">,</span>
                                <span class="n">only_new</span><span class="o">=</span><span class="n">only_new</span><span class="p">,</span>
                                <span class="n">labels_cfg</span><span class="o">=</span><span class="n">labels_cfg</span><span class="p">,</span>
                                <span class="n">view_name</span><span class="o">=</span><span class="n">view_name</span><span class="p">,</span>
                                <span class="n">choose</span><span class="o">=</span><span class="n">choose</span><span class="p">)</span></div>



<div class="viewcode-block" id="Parse.parse_tsv"><a class="viewcode-back" href="../../reference.html#ms3.parse.Parse.parse_tsv">[docs]</a>    <span class="k">def</span> <span class="nf">parse_tsv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                  <span class="n">view_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">level</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">cols</span><span class="o">=</span><span class="p">{},</span>
                  <span class="n">infer_types</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">only_new</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                  <span class="n">choose</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="s1">&#39;ask&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;all&#39;</span><span class="p">,</span>
                  <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Parse TSV files (or other value-separated files such as CSV) to be able to do something with them.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        keys : :obj:`str` or :obj:`~collections.abc.Collection`, optional</span>
<span class="sd">            Key(s) for which to parse all non-MSCX files.  By default, all keys are selected.</span>
<span class="sd">        ids : :obj:`~collections.abc.Collection`</span>
<span class="sd">            To parse only particular files, pass there IDs. ``keys`` and ``fexts`` are ignored in this case.</span>
<span class="sd">        fexts :  :obj:`str` or :obj:`~collections.abc.Collection`, optional</span>
<span class="sd">            If you want to parse only files with one or several particular file extension(s), pass the extension(s)</span>
<span class="sd">        cols : :obj:`dict`, optional</span>
<span class="sd">            By default, if a column called ``&#39;label&#39;`` is found, the TSV is treated as an annotation table and turned into</span>
<span class="sd">            an Annotations object. Pass one or several column name(s) to treat *them* as label columns instead. If you</span>
<span class="sd">            pass ``{}`` or no label column is found, the TSV is parsed as a &quot;normal&quot; table, i.e. a DataFrame.</span>
<span class="sd">        infer_types : :obj:`dict`, optional</span>
<span class="sd">            To recognize one or several custom label type(s), pass ``{name: regEx}``.</span>
<span class="sd">        level : {&#39;W&#39;, &#39;D&#39;, &#39;I&#39;, &#39;E&#39;, &#39;C&#39;, &#39;WARNING&#39;, &#39;DEBUG&#39;, &#39;INFO&#39;, &#39;ERROR&#39;, &#39;CRITICAL&#39;}, optional</span>
<span class="sd">            Pass a level name for which (and above which) you want to see log records.</span>
<span class="sd">        **kwargs:</span>
<span class="sd">            Arguments for :py:meth:`pandas.DataFrame.to_csv`. Defaults to ``{&#39;sep&#39;: &#39;\t&#39;, &#39;index&#39;: False}``. In particular,</span>
<span class="sd">            you might want to update the default dictionaries for ``dtypes`` and ``converters`` used in :py:func:`load_tsv`.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        Args:</span>
<span class="sd">            only_new:</span>
<span class="sd">            view_name:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">level</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">change_logger_cfg</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">level</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">corpus_name</span><span class="p">,</span> <span class="n">corpus</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter_corpora</span><span class="p">(</span><span class="n">view_name</span><span class="o">=</span><span class="n">view_name</span><span class="p">):</span>
            <span class="n">corpus</span><span class="o">.</span><span class="n">parse_tsv</span><span class="p">(</span><span class="n">view_name</span><span class="o">=</span><span class="n">view_name</span><span class="p">,</span>
                             <span class="n">cols</span><span class="o">=</span><span class="n">cols</span><span class="p">,</span>
                             <span class="n">infer_types</span><span class="o">=</span><span class="n">infer_types</span><span class="p">,</span>
                             <span class="n">only_new</span><span class="o">=</span><span class="n">only_new</span><span class="p">,</span>
                             <span class="n">choose</span><span class="o">=</span><span class="n">choose</span><span class="p">,</span>
                             <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Corpus</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_corpus</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_corpus</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">corpus_name</span><span class="p">,</span> <span class="n">fname_or_ix</span> <span class="o">=</span> <span class="n">item</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_corpus</span><span class="p">(</span><span class="n">corpus_name</span><span class="p">)[</span><span class="n">fname_or_ix</span><span class="p">]</span>
            <span class="n">corpus_name</span><span class="p">,</span> <span class="o">*</span><span class="n">remainder</span> <span class="o">=</span> <span class="n">item</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_corpus</span><span class="p">(</span><span class="n">corpus_name</span><span class="p">)[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">remainder</span><span class="p">)]</span>

<div class="viewcode-block" id="Parse.__iter__"><a class="viewcode-back" href="../../reference.html#ms3.parse.Parse.__iter__">[docs]</a>    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Corpus</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;  Iterate through all (corpus_name, Corpus) tuples, regardless of any Views.</span>

<span class="sd">        Yields: (corpus_name, Corpus) tuples</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">yield from</span> <span class="bp">self</span><span class="o">.</span><span class="n">corpus_objects</span><span class="o">.</span><span class="n">items</span><span class="p">()</span></div>


<div class="viewcode-block" id="Parse.__repr__"><a class="viewcode-back" href="../../reference.html#ms3.parse.Parse.__repr__">[docs]</a>    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Show the :meth:`info` under the active view.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">return_str</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">parsed_mscx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Deprecated property. Replaced by :attr:`n_parsed_scores`&quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">DeprecationWarning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Property has been renamed to n_parsed_scores.&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">parsed_tsv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Deprecated property. Replaced by :attr:`n_parsed_tsvs`&quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">DeprecationWarning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Property has been renamed to n_parsed_tsvs.&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="Parse.add_detached_annotations"><a class="viewcode-back" href="../../reference.html#ms3.parse.Parse.add_detached_annotations">[docs]</a>    <span class="k">def</span> <span class="nf">add_detached_annotations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Deprecated method. Replaced by :meth:`insert_detached_labels`.&quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">DeprecationWarning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Method not in use any more. Use Parse.insert_detached_labels().&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Parse.count_annotation_layers"><a class="viewcode-back" href="../../reference.html#ms3.parse.Parse.count_annotation_layers">[docs]</a>    <span class="k">def</span> <span class="nf">count_annotation_layers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Deprecated method.&quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">DeprecationWarning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Method not in use any more.&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Parse.count_labels"><a class="viewcode-back" href="../../reference.html#ms3.parse.Parse.count_labels">[docs]</a>    <span class="k">def</span> <span class="nf">count_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Deprecated method.&quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">DeprecationWarning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Method not in use any more.&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Parse.get_lists"><a class="viewcode-back" href="../../reference.html#ms3.parse.Parse.get_lists">[docs]</a>    <span class="k">def</span> <span class="nf">get_lists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Deprecated method. Replaced by :meth:`get_facets`.&quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">DeprecationWarning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Method get_lists() not in use any more. Use Parse.get_facets() instead.&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Parse.iter"><a class="viewcode-back" href="../../reference.html#ms3.parse.Parse.iter">[docs]</a>    <span class="k">def</span> <span class="nf">iter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Deprecated method. Replaced by :meth:`ms3.corpus.Corpus.iter_facets`.&quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">DeprecationWarning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Method iter() not in use any more. Use Corpus.iter_facets() instead.&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Parse.parse_mscx"><a class="viewcode-back" href="../../reference.html#ms3.parse.Parse.parse_mscx">[docs]</a>    <span class="k">def</span> <span class="nf">parse_mscx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Deprecated method. Replaced by :meth:`parse_scores`.&quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">DeprecationWarning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Method not in use any more. Use Parse.parse_scores().&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Parse.pieces"><a class="viewcode-back" href="../../reference.html#ms3.parse.Parse.pieces">[docs]</a>    <span class="k">def</span> <span class="nf">pieces</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Deprecated method. Replaced by :meth:`info`.&quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">DeprecationWarning</span><span class="p">(</span><span class="s2">&quot;This method is deprecated. To view pieces, call Corpus.info() or Corpus.info(&#39;all&#39;). &quot;</span>
                                 <span class="s2">&quot;A DataFrame showing all detected files is available under the property Corpus.files_df&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Parse.store_scores"><a class="viewcode-back" href="../../reference.html#ms3.parse.Parse.store_scores">[docs]</a>    <span class="k">def</span> <span class="nf">store_scores</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Deprecated method. Replaced by :meth:`store_parsed_scores`.&quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">DeprecationWarning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Method not in use any more. Use Parse.store_parsed_scores().&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Parse.update_metadata"><a class="viewcode-back" href="../../reference.html#ms3.parse.Parse.update_metadata">[docs]</a>    <span class="k">def</span> <span class="nf">update_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span> <span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Deprecated method. Replaced by :meth:`update_score_metadata_from_tsv`.&quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">DeprecationWarning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Method not in use any more. Use Parse.update_score_metadata_from_tsv().&quot;</span><span class="p">)</span></div></div>

<span class="c1">########################################################################################################################</span>
<span class="c1">########################################################################################################################</span>
<span class="c1">################################################# End of Parse() ########################################################</span>
<span class="c1">########################################################################################################################</span>
<span class="c1">########################################################################################################################</span>
</pre></div>

            </article>
            
            
            
            <footer class="bd-footer-article">
                <!-- Previous / next buttons -->
<div class='prev-next-area'>
</div>
            </footer>
            
          </div>
          
          
          
            <div class="bd-sidebar-secondary bd-toc">
              
<div class="toc-item">
  
<div id="searchbox"></div>
</div>

<div class="toc-item">
  
</div>

<div class="toc-item">
  
</div>

            </div>
          
          
        </div>
        <footer class="bd-footer-content">
          <div class="bd-footer-content__inner">
            
          </div>
        </footer>
        
      </main>
    </div>
  </div>

  
    
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=796348d33e8b1d947c94"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=796348d33e8b1d947c94"></script>

  <footer class="bd-footer"><div class="bd-footer__inner container">
  
  <div class="footer-item">
    
<p class="copyright">

    &copy; Copyright 2020, johentsch.<br>

</p>

  </div>
  
  <div class="footer-item">
    <p class="theme-version">
    Built with the
    <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">
        PyData Sphinx Theme
    </a>
    0.12.0.
</p>
  </div>
  
  <div class="footer-item">
    
<p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 5.3.0.<br>
</p>

  </div>
  
</div>
  </footer>
  </body>
</html>